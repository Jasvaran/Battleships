(()=>{"use strict";var e={d:(t,r)=>{for(var s in r)e.o(r,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:r[s]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{Ps:()=>c,Kp:()=>p});let t=document.querySelector(".player-1-content"),r=document.querySelector(".player-2-content");const s=document.querySelector(".start-game"),i=document.querySelector(".notify"),o=document.querySelector(".submit"),l=document.querySelector("#attack");let n=!1;s.addEventListener("click",(async function(){if(0==n){n=!0;let e=p();!function(e,s){let i=document.querySelectorAll("#main-grid");i.forEach(((e,t)=>{e.style.setProperty("--grid-rows",2),e.style.setProperty("--grid-cols",2),e.setAttribute("class",`player-${t+1}-grid`);for(let t=0;t<4;t++){let r=document.createElement("div");r.innerText=t,r.className="grid-item",e.appendChild(r)}})),t.appendChild(i[0]),r.appendChild(i[1]),function(e){let t=document.querySelectorAll(".grid-item"),r=[];e.board.forEach((e=>{e.forEach((e=>{r.push(e.box)}))}));let s=Array.from(t);const i=Math.ceil(s.length/2),o=s.splice(0,i),l=s.splice(-i),n=[];n.push(o,l),n.forEach((e=>{e.forEach(((e,t)=>{e.setAttribute("data-key",`[${r[t]}]`),e.setAttribute("data-ship",!1),e.innerHTML=`[${r[t]}]`}))}))}(c(2))}(),function(e){let t=document.querySelectorAll(".grid-item"),r=Array.from(t);const s=Math.ceil(r.length/2),i=r.splice(0,s),o=r.splice(-s);e.player_1_board.gridItems=i,e.player_2_board.gridItems=o}(e),console.log(e),await async function(e){let t=[];for(let r=0;r<2;r++){i.innerHTML=`Player 1 assign ship ${r+1}`;let s=!1;for(;!s;){let r=await new Promise((e=>{o.onclick=function(){let t=l.value;l.value="",e(t)}}));if(e.validMoves.some((e=>e===r))&&!t.includes(r)){let i=[],o=parseInt(r[1]),l=parseInt(r[3]);i.push(o,l),e.player_1_board.placeShip(i),e.player_1_board.manipulateDom(i),t.push(r),console.log(e.player_1_board),s=!0}else alert("Example: '[0,0]' // cannot place multiple ships in same coordinates")}}i.innerHTML=""}(e),function(e){const t=e.validMoves;let r=[];for(let s=0;s<2;s++){const s=t[Math.floor(Math.random()*t.length)];if(!r.includes(s)){let t=[],i=parseInt(s[1]),o=parseInt(s[3]);t.push(i,o),e.player_2_board.placeShip(t),e.player_2_board.manipulateDom(t),r.push(s),console.log(e.player_2_board)}}}(e)}else 1==n&&alert("game in progress")}));const a=(e,t,r)=>({length:e,sunk:t,noOfHits:r,hitShip:function(){this.noOfHits++,this.isSunk()},isSunk(){this.length==this.noOfHits&&(this.sunk=!0)}}),c=e=>{let t=[],r=[];for(let t=0;t<e;t++){r[t]=[];for(let s=0;s<e;s++)r[t][s]={box:[t,s]}}return{board:r,manipulateDom([e,t]){if(this.gridItems){let r=JSON.stringify([e,t]);console.log(r),this.gridItems.forEach((e=>{e.dataset.key===r&&(e.dataset.ship=!0,e.style.color="red")}))}},placeShip([e,t]){let r;return this.board.forEach((s=>{s.forEach((s=>{if(s.box[0]===e&&s.box[1]===t){if("ship"in s==0)return s.ship=a(1,!1,0),r="placed ship",this.noOfShips++,s;if("ship"in s==1)return void(r="already placed ship here")}}))})),r},recieveAttack([e,r]){let s;return this.board.forEach((i=>{i.forEach((i=>{i.box[0]===e&&i.box[1]===r&&"ship"in i==1?(i.ship.hitShip(),this.noOfSuccesfulHits++,s=i.ship.noOfHits,console.log("hit ship")):i.box[0]===e&&i.box[1]===r&&"ship"in i==0&&(console.log("missed ship"),this.missedHits.push([e,r]),s=t)}))})),this.checkShipStatus(),s},checkShipStatus(){this.noOfShips>0&&this.noOfSuccesfulHits==this.noOfShips&&(console.log("All ships sunk"),this.allShipsSunk=!0)},missedHits:t,noOfShips:0,noOfSuccesfulHits:0,allShipsSunk:!1}},h=e=>({name:e,winner:!1}),p=()=>{let e=!0,t=!0,r=!1,s=[],i=[],o=[],l=h("player 1"),n=h("player 2"),a=c(2),p=c(2);a.ai=!1,p.ai=!0;for(let e=0;e<a.board.length;e++)a.board[e].forEach((e=>{let t=JSON.stringify(e.box);o.push(t)}));return{player1:l,player2:n,player_1_board:a,player_2_board:p,player2_history:i,player1_turn:t,player2_turn:r,validMoves:o,p1_shipsReady:!1,p2_shipsReady:!1,checkMoves:(e,t)=>t.some((t=>t===e)),checkHistory:(e,t)=>t.some((t=>t===e)),recieveInput(e,t){let r,s=!1;for(;!s;){let i=prompt(e.name+" enter coordinates");if(0==this.checkHistory(i,t)&&1==this.checkMoves(i,o))return alert("valid"),t.push(i),s=!0,r=i,i;1!=this.checkHistory(i,t)&&0!=this.checkMoves(i,o)||alert("must make valid move")}return r},registerTurn(e,t){let r=[],s=parseInt(t[1]),i=parseInt(t[3]);r.push(s,i),e.recieveAttack(r),console.log(e.board)},makeMoves(){for(;!0===e;){if(1==t){console.log("player 1 turn");let e=this.recieveInput(l,i);this.registerTurn(p,e),console.log(e),t=!1,r=!0}else if(1==r){console.log("player 2 turn");let e=this.recieveInput(n,s);this.registerTurn(a,e),console.log(e),r=!1,t=!0}this.endGame(a,p)}},endGame(t,r){1!=t.allShipsSunk&&1!=r.allShipsSunk||(e=!1)}}};p()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUlRLEVBQVFzQixLQUFLeUMsYUFBYVosRUFBU0QsR0FDdkM1QixLQUFLNkMsYUFBYTlFLEVBQWdCVyxHQUNsQ1QsUUFBUUMsSUFBSVEsR0FDWitDLEdBQWUsRUFDZkMsR0FBZSxDQUNuQixNQUNLLEdBQW9CLEdBQWhCQSxFQUFxQixDQUMxQnpELFFBQVFDLElBQUksaUJBQ1osSUFBSVEsRUFBUXNCLEtBQUt5QyxhQUFhWCxFQUFTSCxHQUN2QzNCLEtBQUs2QyxhQUFhaEYsRUFBZ0JhLEdBQ2xDVCxRQUFRQyxJQUFJUSxHQUNaZ0QsR0FBZSxFQUNmRCxHQUFlLENBQ25CLENBQ0F6QixLQUFLaUQsUUFBUXBGLEVBQWdCRSxFQUNqQyxDQUNKLEVBQ0FrRixRQUFRQyxFQUFjQyxHQUNlLEdBQTdCRCxFQUFhL0IsY0FBcUQsR0FBN0JnQyxFQUFhaEMsZUFDbERLLEdBQVksRUFFcEIsRUE0QkosRUFFSUQsRyIsInNvdXJjZXMiOlsid2VicGFjazovL2JhdHRsZXNoaXBzL3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovL2JhdHRsZXNoaXBzL3dlYnBhY2svcnVudGltZS9kZWZpbmUgcHJvcGVydHkgZ2V0dGVycyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwcy93ZWJwYWNrL3J1bnRpbWUvaGFzT3duUHJvcGVydHkgc2hvcnRoYW5kIiwid2VicGFjazovL2JhdHRsZXNoaXBzLy4vc3JjL2RvbS5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwcy8uL3NyYy9pbmRleC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBUaGUgcmVxdWlyZSBzY29wZVxudmFyIF9fd2VicGFja19yZXF1aXJlX18gPSB7fTtcblxuIiwiLy8gZGVmaW5lIGdldHRlciBmdW5jdGlvbnMgZm9yIGhhcm1vbnkgZXhwb3J0c1xuX193ZWJwYWNrX3JlcXVpcmVfXy5kID0gKGV4cG9ydHMsIGRlZmluaXRpb24pID0+IHtcblx0Zm9yKHZhciBrZXkgaW4gZGVmaW5pdGlvbikge1xuXHRcdGlmKF9fd2VicGFja19yZXF1aXJlX18ubyhkZWZpbml0aW9uLCBrZXkpICYmICFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywga2V5KSkge1xuXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIGtleSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGRlZmluaXRpb25ba2V5XSB9KTtcblx0XHR9XG5cdH1cbn07IiwiX193ZWJwYWNrX3JlcXVpcmVfXy5vID0gKG9iaiwgcHJvcCkgPT4gKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIHByb3ApKSIsImltcG9ydCAqIGFzIG1haW5HYW1lTW9kdWxlIGZyb20gJy4vaW5kZXgnXG5cbmxldCBwbGF5ZXIxX2NvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wbGF5ZXItMS1jb250ZW50JylcbmxldCBwbGF5ZXIyX2NvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wbGF5ZXItMi1jb250ZW50JylcbmNvbnN0IHN0YXJ0R2FtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zdGFydC1nYW1lJylcbmNvbnN0IG5vdGlmeURvbSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5ub3RpZnknKVxuY29uc3Qgc3VibWl0QnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnN1Ym1pdCcpXG5jb25zdCBpbnB1dEJhciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNhdHRhY2snKVxuXG5sZXQgZ2FtZVN0YXJ0ZWQgPSBmYWxzZVxuXG4vLyBjbGljayBzdGFydCBnYW1lXG4vLyBjcmVhdGUgZ3JpZHMgb24gc2NyZWVuXG5zdGFydEdhbWUuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBhc3luYyBmdW5jdGlvbigpICB7XG4gICAgaWYgKGdhbWVTdGFydGVkID09IGZhbHNlKXtcbiAgICAgICAgZ2FtZVN0YXJ0ZWQgPSB0cnVlXG4gICAgICAgIGxldCBtYWluID0gbWFpbkdhbWVNb2R1bGUubWFpbkdhbWVGdW5jdGlvbigpXG4gICAgICAgIGNyZWF0ZUdyaWRzKDIsMilcbiAgICAgICAgYXNzaWduQ2VsbHNUb1BsYXllckJvYXJkcyhtYWluKVxuICAgICAgICBjb25zb2xlLmxvZyhtYWluKVxuICAgICAgICBhd2FpdCBzZXRQbGF5ZXJPbmVTaGlwcyhtYWluKVxuICAgICAgICBzZXRQbGF5ZXJUd29TaGlwcyhtYWluKVxuICAgIH1cbiAgICBlbHNlIGlmIChnYW1lU3RhcnRlZCA9PSB0cnVlKXtcbiAgICAgICAgYWxlcnQoJ2dhbWUgaW4gcHJvZ3Jlc3MnKVxuICAgIH1cblxufSlcblxuLy8gYXNrIHBsYXllcjEgdG8gYXNzaWduIGhpcyBzaGlwc1xuYXN5bmMgZnVuY3Rpb24gc2V0UGxheWVyT25lU2hpcHMobWFpbkdhbWVGbil7XG4gICAgbGV0IGhpc3RvcnkgPSBbXVxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMjsgaSsrKXtcbiAgICAgICAgbm90aWZ5RG9tLmlubmVySFRNTCA9IGBQbGF5ZXIgMSBhc3NpZ24gc2hpcCAke2kgKyAxfWBcbiAgICAgICAgbGV0IHZhbGlkX2FucyA9IGZhbHNlXG4gICAgICAgIHdoaWxlKCF2YWxpZF9hbnMpe1xuICAgICAgICAgICAgbGV0IGdldGlucHV0ID0gYXdhaXQgaW5wdXQoKVxuICAgICAgICAgICAgaWYgKG1haW5HYW1lRm4udmFsaWRNb3Zlcy5zb21lKGVsZSA9PiBlbGUgPT09IGdldGlucHV0KSAmJiAhaGlzdG9yeS5pbmNsdWRlcyhnZXRpbnB1dCkpe1xuICAgICAgICAgICAgICAgIGxldCBjb29yZHMgPSBbXVxuICAgICAgICAgICAgICAgIGxldCB4ID0gcGFyc2VJbnQoZ2V0aW5wdXRbMV0pXG4gICAgICAgICAgICAgICAgbGV0IHkgPSBwYXJzZUludChnZXRpbnB1dFszXSlcbiAgICAgICAgICAgICAgICBjb29yZHMucHVzaCh4LCB5KVxuICAgICAgICAgICAgICAgIG1haW5HYW1lRm4ucGxheWVyXzFfYm9hcmQucGxhY2VTaGlwKGNvb3JkcylcbiAgICAgICAgICAgICAgICBtYWluR2FtZUZuLnBsYXllcl8xX2JvYXJkLm1hbmlwdWxhdGVEb20oY29vcmRzKVxuICAgICAgICAgICAgICAgIGhpc3RvcnkucHVzaChnZXRpbnB1dClcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhtYWluR2FtZUZuLnBsYXllcl8xX2JvYXJkKVxuXG4gICAgICAgICAgICAgICAgdmFsaWRfYW5zID0gdHJ1ZVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgYWxlcnQoJ0V4YW1wbGU6IFxcJ1swLDBdXFwnIC8vIGNhbm5vdCBwbGFjZSBtdWx0aXBsZSBzaGlwcyBpbiBzYW1lIGNvb3JkaW5hdGVzJylcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBub3RpZnlEb20uaW5uZXJIVE1MID0gXCJcIjtcbn1cblxuZnVuY3Rpb24gaW5wdXQoKXtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICAgICAgc3VibWl0QnRuLm9uY2xpY2sgPSBmdW5jdGlvbiAoKXtcbiAgICAgICAgICAgIGxldCBpbnB1dCA9IGlucHV0QmFyLnZhbHVlXG4gICAgICAgICAgICBpbnB1dEJhci52YWx1ZSA9IFwiXCI7XG4gICAgICAgICAgICByZXNvbHZlKGlucHV0KVxuICAgICAgICB9XG4gICAgfSlcbn1cblxuXG4vLyBhc3NpZ24gcGxheWVyMiBzaGlwc1xuXG5mdW5jdGlvbiBzZXRQbGF5ZXJUd29TaGlwcyhtYWluR2FtZUZuKXtcbiAgICBjb25zdCB2YWxpZF9jb29yZHMgPSBtYWluR2FtZUZuLnZhbGlkTW92ZXNcbiAgICBsZXQgaGlzdG9yeSA9IFtdXG4gICAgXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCAyOyBpKyspe1xuICAgICAgICBjb25zdCByYW5kb21Db29yZCA9IHZhbGlkX2Nvb3Jkc1tNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiB2YWxpZF9jb29yZHMubGVuZ3RoKV1cbiAgICAgICAgaWYgKCFoaXN0b3J5LmluY2x1ZGVzKHJhbmRvbUNvb3JkKSl7XG4gICAgICAgICAgICBsZXQgY29vcmRzID0gW11cbiAgICAgICAgICAgIGxldCB4ID0gcGFyc2VJbnQocmFuZG9tQ29vcmRbMV0pXG4gICAgICAgICAgICBsZXQgeSA9IHBhcnNlSW50KHJhbmRvbUNvb3JkWzNdKVxuICAgICAgICAgICAgY29vcmRzLnB1c2goeCwgeSlcbiAgICAgICAgICAgIG1haW5HYW1lRm4ucGxheWVyXzJfYm9hcmQucGxhY2VTaGlwKGNvb3JkcylcbiAgICAgICAgICAgIG1haW5HYW1lRm4ucGxheWVyXzJfYm9hcmQubWFuaXB1bGF0ZURvbShjb29yZHMpXG4gICAgICAgICAgICBoaXN0b3J5LnB1c2gocmFuZG9tQ29vcmQpXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhtYWluR2FtZUZuLnBsYXllcl8yX2JvYXJkKVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY29udGludWVcbiAgICAgICAgfVxuICAgIH1cblxufVxuXG5cbi8vIHdoZW4gYWxsIHNoaXBzIGFyZSBhc3NpZ25lZCBzdGFydCB0byBtYWtlIE1vdmVzXG5cblxuXG5cbmZ1bmN0aW9uIGNyZWF0ZUdyaWRzKHJvd3MsIGNvbHMpeyAgICBcbiAgICBsZXQgY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnI21haW4tZ3JpZCcpXG4gICAgY29udGFpbmVyLmZvckVhY2goKG9iaiwgaW5kZXgpID0+IHtcbiAgICAgICAgb2JqLnN0eWxlLnNldFByb3BlcnR5KCctLWdyaWQtcm93cycsIHJvd3MpXG4gICAgICAgIG9iai5zdHlsZS5zZXRQcm9wZXJ0eSgnLS1ncmlkLWNvbHMnLCBjb2xzKVxuICAgICAgICBvYmouc2V0QXR0cmlidXRlKCdjbGFzcycsIGBwbGF5ZXItJHtpbmRleCArIDF9LWdyaWRgKVxuXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgKHJvd3MgKiBjb2xzKTsgaSsrKXtcbiAgICAgICAgICAgIGxldCBjZWxsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JylcbiAgICAgICAgICAgIGNlbGwuaW5uZXJUZXh0ID0gKGkpXG4gICAgICAgICAgICBjZWxsLmNsYXNzTmFtZSA9ICdncmlkLWl0ZW0nXG4gICAgICAgICAgICBvYmouYXBwZW5kQ2hpbGQoY2VsbClcbiAgICAgICAgfVxuICAgIH0pXG5cbiAgICBwbGF5ZXIxX2NvbnRhaW5lci5hcHBlbmRDaGlsZChjb250YWluZXJbMF0pXG4gICAgcGxheWVyMl9jb250YWluZXIuYXBwZW5kQ2hpbGQoY29udGFpbmVyWzFdKVxuICAgIGxldCByZWZlcmVuY2VCb2FyZCA9IG1haW5HYW1lTW9kdWxlLmdhbWVCb2FyZEZhY3RvcnkoMilcbiAgICBjcmVhdGVDb29yZGluYXRlQXJyYXkocmVmZXJlbmNlQm9hcmQpXG59XG5cbmZ1bmN0aW9uIGNyZWF0ZUNvb3JkaW5hdGVBcnJheShnYW1lYm9hcmQpe1xuICAgIC8vIGNyZWF0ZXMgY29vcmRpbmF0ZXMgdG8gYXNzaWduIHRvIGVhY2ggY2VsbHMgZGF0YSBhdHRyaWJ1dGUgYW5kIGlubmVyIEhUTUxcbiAgICBsZXQgY2VsbExpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuZ3JpZC1pdGVtJylcbiAgICBsZXQgY29vcmRzID0gW107XG4gICAgZ2FtZWJvYXJkLmJvYXJkLmZvckVhY2goYXJyID0+IHtcbiAgICAgICAgYXJyLmZvckVhY2gob2JqID0+IHtcbiAgICAgICAgICAgIGNvb3Jkcy5wdXNoKG9iai5ib3gpXG4gICAgICAgIH0pXG4gICAgfSlcblxuICAgIGxldCBjZWxsX2xpc3RfYXJyYXkgPSBBcnJheS5mcm9tKGNlbGxMaXN0KVxuICAgIGNvbnN0IG1pZGRsZUluZGV4ID0gTWF0aC5jZWlsKGNlbGxfbGlzdF9hcnJheS5sZW5ndGggLyAyKVxuICAgIGNvbnN0IGZpcnN0SGFsZiA9IGNlbGxfbGlzdF9hcnJheS5zcGxpY2UoMCwgbWlkZGxlSW5kZXgpXG4gICAgY29uc3Qgc2Vjb25kSGFsZiA9IGNlbGxfbGlzdF9hcnJheS5zcGxpY2UoLW1pZGRsZUluZGV4KVxuXG4gICAgY29uc3Qgc3BsaXRfYXJyYXkgPSBbXVxuICAgIHNwbGl0X2FycmF5LnB1c2goZmlyc3RIYWxmLCBzZWNvbmRIYWxmKVxuXG4gICAgXG4gICAgc3BsaXRfYXJyYXkuZm9yRWFjaChhcnJheSA9PiB7XG4gICAgICAgIGFycmF5LmZvckVhY2goKGNlbGwsIGluZGV4KSA9PiB7XG4gICAgICAgICAgICBjZWxsLnNldEF0dHJpYnV0ZSgnZGF0YS1rZXknLCBgWyR7Y29vcmRzW2luZGV4XX1dYClcbiAgICAgICAgICAgIGNlbGwuc2V0QXR0cmlidXRlKCdkYXRhLXNoaXAnLCBmYWxzZSlcbiAgICAgICAgICAgIGNlbGwuaW5uZXJIVE1MID0gYFske2Nvb3Jkc1tpbmRleF19XWAgXG4gICAgICAgIH0pXG4gICAgfSlcbn1cblxuZnVuY3Rpb24gYXNzaWduQ2VsbHNUb1BsYXllckJvYXJkcyhnYW1lQm9hcmQpe1xuICAgIGxldCBjZWxsTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5ncmlkLWl0ZW0nKVxuICAgIGxldCBjZWxsX2xpc3RfYXJyYXkgPSBBcnJheS5mcm9tKGNlbGxMaXN0KVxuICAgIGNvbnN0IG1pZGRsZUluZGV4ID0gTWF0aC5jZWlsKGNlbGxfbGlzdF9hcnJheS5sZW5ndGggLyAyKVxuICAgIGNvbnN0IGZpcnN0SGFsZiA9IGNlbGxfbGlzdF9hcnJheS5zcGxpY2UoMCwgbWlkZGxlSW5kZXgpXG4gICAgY29uc3Qgc2Vjb25kSGFsZiA9IGNlbGxfbGlzdF9hcnJheS5zcGxpY2UoLW1pZGRsZUluZGV4KVxuXG4gICAgZ2FtZUJvYXJkLnBsYXllcl8xX2JvYXJkLmdyaWRJdGVtcyA9IGZpcnN0SGFsZlxuICAgIGdhbWVCb2FyZC5wbGF5ZXJfMl9ib2FyZC5ncmlkSXRlbXMgPSBzZWNvbmRIYWxmXG5cblxufVxuXG5cblxuXG5leHBvcnQge1xuICAgIGNyZWF0ZUdyaWRzLFxuICAgIHBsYXllcjFfY29udGFpbmVyLFxuICAgIGNyZWF0ZUNvb3JkaW5hdGVBcnJheSxcbn0iLCJpbXBvcnQgKiBhcyBkb20gZnJvbSAnLi9kb20nXG5cbmNvbnN0IHNoaXBGYWN0b3J5ID0gKGxlbmd0aCwgc3Vuaywgbm9PZkhpdHMpID0+IHtcbiAgICBcbiAgICBmdW5jdGlvbiBoaXRTaGlwKCl7XG4gICAgICAgIHRoaXMubm9PZkhpdHMrK1xuICAgICAgICB0aGlzLmlzU3VuaygpXG4gICAgfVxuICAgIFxuICAgIHJldHVybiB7IGxlbmd0aCwgXG4gICAgICAgICAgICAgc3VuaywgXG4gICAgICAgICAgICAgbm9PZkhpdHMsIFxuICAgICAgICAgICAgIGhpdFNoaXAsIFxuICAgICAgICAgICAgIGlzU3Vuaygpe1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmxlbmd0aCA9PSB0aGlzLm5vT2ZIaXRzKXtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdW5rID0gdHJ1ZVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG59XG5cblxuY29uc3QgZ2FtZUJvYXJkRmFjdG9yeSA9IChzaXplT2ZCb2FyZCkgPT4ge1xuICAgXG4gICAgbGV0IG5vT2ZTaGlwcyA9IDBcbiAgICBsZXQgbm9PZlN1Y2Nlc2Z1bEhpdHMgPSAwIFxuICAgIGxldCBtaXNzZWRIaXRzID0gW10gXG4gICAgbGV0IGJvYXJkID0gW11cbiAgICBsZXQgYWxsU2hpcHNTdW5rID0gZmFsc2VcblxuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzaXplT2ZCb2FyZDsgaSsrKXtcbiAgICBib2FyZFtpXSA9IFtdXG4gICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgc2l6ZU9mQm9hcmQ7IGorKyl7XG4gICAgICAgICAgICBib2FyZFtpXVtqXSA9IHtib3g6IFtpLCBqXX1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICAgIGJvYXJkLFxuICAgICAgICBtYW5pcHVsYXRlRG9tKFt4LHldKXtcbiAgICAgICAgICAgIC8vIHNldHMgY2VsbHMgZGF0YSBzaGlwIGF0dHJpYnV0ZSB0byB0cnVlIHdoZW4gc2hpcCBpcyBwbGFjZWQgaW4gaXQuXG4gICAgICAgICAgICBpZiAodGhpcy5ncmlkSXRlbXMpe1xuICAgICAgICAgICAgICAgIGxldCBjb29yZCA9IEpTT04uc3RyaW5naWZ5KFt4LHldKVxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGNvb3JkKVxuICAgICAgICAgICAgICAgIHRoaXMuZ3JpZEl0ZW1zLmZvckVhY2goY2VsbCA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjZWxsLmRhdGFzZXQua2V5ID09PSBjb29yZCl7XG4gICAgICAgICAgICAgICAgICAgICAgICBjZWxsLmRhdGFzZXQuc2hpcCA9IHRydWVcbiAgICAgICAgICAgICAgICAgICAgICAgIGNlbGwuc3R5bGUuY29sb3IgPSAncmVkJ1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgcGxhY2VTaGlwKFt4LCB5XSl7XG4gICAgICAgICAgICAvLyBwbGFjZXMgYSBzaGlwIG9iamVjdCBhdCBzcGVjaWZpZWQgY29vcmRpbmF0ZXNcbiAgICAgICAgICAgIGxldCBzaGlwX3BsYWNlZDtcbiAgICAgICAgICAgIHRoaXMuYm9hcmQuZm9yRWFjaChyb3cgPT4ge1xuICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCd0aGVzZSBhcmUgdGhlIHJvd3Mgb2YgYXJyYXlzICcsIHJvdylcbiAgICAgICAgICAgICAgICByb3cuZm9yRWFjaChvYmogPT4ge1xuICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygndGhlc2UgYXJlIHRoZSBvYmplY3RzIGluIHJvd3MnLCBvYmopXG4gICAgICAgICAgICAgICAgICAgIGlmKG9iai5ib3hbMF0gPT09IHggJiYgb2JqLmJveFsxXSA9PT0geSl7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoJ3NoaXAnIGluIG9iaiA9PT0gZmFsc2Upe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5zaGlwID0gc2hpcEZhY3RvcnkoMSwgZmFsc2UsIDApXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2cob2JqKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNoaXBfcGxhY2VkID0gJ3BsYWNlZCBzaGlwJ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubm9PZlNoaXBzKytcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2JqXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICgnc2hpcCcgaW4gb2JqID09PSB0cnVlKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaGlwX3BsYWNlZCA9ICdhbHJlYWR5IHBsYWNlZCBzaGlwIGhlcmUnXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgcmV0dXJuIHNoaXBfcGxhY2VkXG4gICAgICAgIH0sXG4gICAgICAgIHJlY2lldmVBdHRhY2soW3gsIHldKXtcbiAgICAgICAgICAgIGxldCBzdGF0ZTtcbiAgICAgICAgICAgIHRoaXMuYm9hcmQuZm9yRWFjaChyb3cgPT4ge1xuICAgICAgICAgICAgICAgIHJvdy5mb3JFYWNoKG9iaiA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChvYmouYm94WzBdID09PSB4ICYmIG9iai5ib3hbMV0gPT09IHkgJiYgJ3NoaXAnIGluIG9iaiA9PT0gdHJ1ZSl7XG4gICAgICAgICAgICAgICAgICAgICAgICBvYmouc2hpcC5oaXRTaGlwKClcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubm9PZlN1Y2Nlc2Z1bEhpdHMrK1xuICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUgPSBvYmouc2hpcC5ub09mSGl0c1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2hpdCBzaGlwJylcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmKG9iai5ib3hbMF0gPT09IHggJiYgb2JqLmJveFsxXSA9PT0geSAmJiAnc2hpcCcgaW4gb2JqID09PSBmYWxzZSl7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnbWlzc2VkIHNoaXAnKVxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5taXNzZWRIaXRzLnB1c2goW3gsIHldKVxuICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUgPSBtaXNzZWRIaXRzXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIHRoaXMuY2hlY2tTaGlwU3RhdHVzKClcbiAgICAgICAgICAgIHJldHVybiBzdGF0ZVxuICAgICAgICB9LFxuICAgICAgICBjaGVja1NoaXBTdGF0dXMoKXtcbiAgICAgICAgICAgIGlmICh0aGlzLm5vT2ZTaGlwcyA+IDAgJiYgdGhpcy5ub09mU3VjY2VzZnVsSGl0cyA9PSB0aGlzLm5vT2ZTaGlwcyl7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0FsbCBzaGlwcyBzdW5rJylcbiAgICAgICAgICAgICAgICB0aGlzLmFsbFNoaXBzU3VuayA9IHRydWVcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgbWlzc2VkSGl0cyxcbiAgICAgICAgbm9PZlNoaXBzLFxuICAgICAgICBub09mU3VjY2VzZnVsSGl0cyxcbiAgICAgICAgYWxsU2hpcHNTdW5rXG4gICAgfVxufVxuXG5jb25zdCBwbGF5ZXJGYWN0b3J5ID0gKG5hbWUpID0+IHtcbiAgICBsZXQgd2lubmVyID0gZmFsc2VcblxuICAgIHJldHVybiB7XG4gICAgICAgIG5hbWUsXG4gICAgICAgIHdpbm5lclxuICAgIH1cbn1cblxuY29uc3QgYWlGYWN0b3J5ID0gKG5hbWUpID0+IHtcbiAgICBsZXQgd2lubmVyID0gZmFsc2VcbiAgICByZXR1cm4ge1xuICAgICAgICBuYW1lLFxuICAgICAgICB3aW5uZXIsICBcbiAgICB9XG59XG5cbmNvbnN0IG1haW5HYW1lRnVuY3Rpb24gPSAoKSA9PiB7XG4gICAgbGV0IGdhbWVTdGFydCA9IHRydWVcbiAgICBsZXQgcGxheWVyMV90dXJuID0gdHJ1ZVxuICAgIGxldCBwbGF5ZXIyX3R1cm4gPSBmYWxzZVxuXG4gICAgbGV0IHBsYXllcjFfaGlzdG9yeSA9IFtdXG4gICAgbGV0IHBsYXllcjJfaGlzdG9yeSA9IFtdXG5cbiAgICBsZXQgcDFfc2hpcHNSZWFkeSA9IGZhbHNlXG4gICAgbGV0IHAyX3NoaXBzUmVhZHkgPSBmYWxzZVxuXG4gICAgbGV0IHZhbGlkTW92ZXMgPSBbXVxuXG5cbiAgICBsZXQgcGxheWVyMSA9IHBsYXllckZhY3RvcnkoJ3BsYXllciAxJylcbiAgICBsZXQgcGxheWVyMiA9IHBsYXllckZhY3RvcnkoJ3BsYXllciAyJylcblxuICAgIGxldCBwbGF5ZXJfMV9ib2FyZCA9IGdhbWVCb2FyZEZhY3RvcnkoMilcbiAgICBsZXQgcGxheWVyXzJfYm9hcmQgPSBnYW1lQm9hcmRGYWN0b3J5KDIpXG4gICAgcGxheWVyXzFfYm9hcmQuYWkgPSBmYWxzZVxuICAgIHBsYXllcl8yX2JvYXJkLmFpID0gdHJ1ZVxuXG5cbiAgICAvLyBmb3IgbG9vcCB0YWtlcyBhbGwgdGhlIGF2YWlsYWJsZSBtb3ZlcyBhbmQgcHV0cyB0aGVtIGluXG4gICAgLy8gYW4gYXJyYXkgYXMgc3RyaW5nIGFycmF5cy4gXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwbGF5ZXJfMV9ib2FyZC5ib2FyZC5sZW5ndGg7IGkrKyl7XG4gICAgICAgIHBsYXllcl8xX2JvYXJkLmJvYXJkW2ldLmZvckVhY2gob2JqID0+IHtcbiAgICAgICAgICAgIGxldCB2YWx1ZXMgPSBKU09OLnN0cmluZ2lmeShvYmouYm94KVxuICAgICAgICAgICAgdmFsaWRNb3Zlcy5wdXNoKHZhbHVlcylcbiAgICAgICAgfSlcbiAgICB9XG5cblxuICAgIHJldHVybiB7IFxuICAgICAgICBwbGF5ZXIxLFxuICAgICAgICBwbGF5ZXIyLFxuICAgICAgICBwbGF5ZXJfMV9ib2FyZCxcbiAgICAgICAgcGxheWVyXzJfYm9hcmQsXG4gICAgICAgIHBsYXllcjJfaGlzdG9yeSxcbiAgICAgICAgcGxheWVyMV90dXJuLFxuICAgICAgICBwbGF5ZXIyX3R1cm4sXG4gICAgICAgIHZhbGlkTW92ZXMsXG4gICAgICAgIHAxX3NoaXBzUmVhZHksXG4gICAgICAgIHAyX3NoaXBzUmVhZHksXG4gICAgICAgIGNoZWNrTW92ZXMoYXR0YWNrQ29vcmRpbmF0ZXMsIG1vdmVzKXtcbiAgICAgICAgICAgIC8vIGNoZWNrIGlmIG1vdmVzIGNhbiBiZSBtYWRlIGluIHRlcm1zIG9mIHBvc3NpYmxlIGNvb3JkaW5hdGVzIHRvIGNob29zZSBmcm9tXG4gICAgICAgICAgICBsZXQgY29udGFpbnMgPSBtb3Zlcy5zb21lKGl0ZW0gPT4gaXRlbSA9PT0gYXR0YWNrQ29vcmRpbmF0ZXMpXG4gICAgICAgICAgICByZXR1cm4gY29udGFpbnNcbiAgICAgICAgfSxcbiAgICAgICAgY2hlY2tIaXN0b3J5KGF0dGFja0Nvb3JkaW5hdGVzLCBwbGF5ZXJIaXN0b3J5KXtcbiAgICAgICAgICAgIC8vIGNoZWNrIGlmIHBsYXllciBhbHJlYWR5IG1hZGUgYSBtb3ZlIHRvIHRoYXQgY29vcmRpbmF0ZVxuICAgICAgICAgICAgLy8gbGV0IGl0ZW0gPSBKU09OLnN0cmluZ2lmeShhdHRhY2tDb29yZGluYXRlcylcbiAgICAgICAgICAgIGxldCBjb250YWlucyA9IHBsYXllckhpc3Rvcnkuc29tZShlbGUgPT4gZWxlID09PSBhdHRhY2tDb29yZGluYXRlcylcbiAgICAgICAgICAgIHJldHVybiBjb250YWluc1xuXG4gICAgICAgIH0sXG4gICAgICAgIHJlY2lldmVJbnB1dChwbGF5ZXIsIGhpc3Rvcnkpe1xuICAgICAgICAgICAgbGV0IHJlc3VsdDtcbiAgICAgICAgICAgIGxldCB2YWxpZF9hbnMgPSBmYWxzZVxuICAgICAgICAgICAgd2hpbGUoIXZhbGlkX2Fucyl7XG4gICAgICAgICAgICAgICAgbGV0IGlucHV0ID0gcHJvbXB0KHBsYXllci5uYW1lICsgJyBlbnRlciBjb29yZGluYXRlcycpXG4gICAgICAgICAgICAgICAgaWYodGhpcy5jaGVja0hpc3RvcnkoaW5wdXQsIGhpc3RvcnkpID09IGZhbHNlICYmIHRoaXMuY2hlY2tNb3ZlcyhpbnB1dCwgdmFsaWRNb3ZlcykgPT0gdHJ1ZSl7XG4gICAgICAgICAgICAgICAgICAgIGFsZXJ0KCd2YWxpZCcpXG4gICAgICAgICAgICAgICAgICAgIGhpc3RvcnkucHVzaChpbnB1dClcbiAgICAgICAgICAgICAgICAgICAgdmFsaWRfYW5zID0gdHJ1ZVxuICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBpbnB1dFxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaW5wdXRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAodGhpcy5jaGVja0hpc3RvcnkoaW5wdXQsIGhpc3RvcnkpID09IHRydWUgfHwgdGhpcy5jaGVja01vdmVzKGlucHV0LCB2YWxpZE1vdmVzKSA9PSBmYWxzZSl7XG4gICAgICAgICAgICAgICAgICAgIGFsZXJ0KCdtdXN0IG1ha2UgdmFsaWQgbW92ZScpXG4gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdFxuICAgICAgICB9LFxuICAgICAgICByZWdpc3RlclR1cm4ocGxheWVyQm9hcmQsIGF0dGFja0lucHV0KXtcbiAgICAgICAgICAgIGxldCBhcnIgPSBbXTtcbiAgICAgICAgICAgIGxldCB4ID0gcGFyc2VJbnQoYXR0YWNrSW5wdXRbMV0pO1xuICAgICAgICAgICAgbGV0IHkgPSBwYXJzZUludChhdHRhY2tJbnB1dFszXSk7XG4gICAgICAgICAgICBhcnIucHVzaCh4LCB5KTtcbiAgICAgICAgICAgIHBsYXllckJvYXJkLnJlY2lldmVBdHRhY2soYXJyKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHBsYXllckJvYXJkLmJvYXJkKVxuICAgICAgICAgICAgfSxcbiAgICAgICAgbWFrZU1vdmVzKCl7XG4gICAgICAgICAgICB3aGlsZShnYW1lU3RhcnQgPT09IHRydWUpe1xuICAgICAgICAgICAgICAgIGlmKHBsYXllcjFfdHVybiA9PSB0cnVlKXtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3BsYXllciAxIHR1cm4nKVxuICAgICAgICAgICAgICAgICAgICBsZXQgaW5wdXQgPSB0aGlzLnJlY2lldmVJbnB1dChwbGF5ZXIxLCBwbGF5ZXIyX2hpc3RvcnkpXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVnaXN0ZXJUdXJuKHBsYXllcl8yX2JvYXJkLCBpbnB1dClcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coaW5wdXQpXG4gICAgICAgICAgICAgICAgICAgIHBsYXllcjFfdHVybiA9IGZhbHNlXG4gICAgICAgICAgICAgICAgICAgIHBsYXllcjJfdHVybiA9IHRydWVcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAocGxheWVyMl90dXJuID09IHRydWUpe1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygncGxheWVyIDIgdHVybicpXG4gICAgICAgICAgICAgICAgICAgIGxldCBpbnB1dCA9IHRoaXMucmVjaWV2ZUlucHV0KHBsYXllcjIsIHBsYXllcjFfaGlzdG9yeSlcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZWdpc3RlclR1cm4ocGxheWVyXzFfYm9hcmQsIGlucHV0KVxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhpbnB1dClcbiAgICAgICAgICAgICAgICAgICAgcGxheWVyMl90dXJuID0gZmFsc2VcbiAgICAgICAgICAgICAgICAgICAgcGxheWVyMV90dXJuID0gdHJ1ZVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLmVuZEdhbWUocGxheWVyXzFfYm9hcmQsIHBsYXllcl8yX2JvYXJkKVxuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBlbmRHYW1lKHBsYXllcjFCb2FyZCwgcGxheWVyMkJvYXJkKXtcbiAgICAgICAgICAgIGlmIChwbGF5ZXIxQm9hcmQuYWxsU2hpcHNTdW5rID09IHRydWUgfHwgcGxheWVyMkJvYXJkLmFsbFNoaXBzU3VuayA9PSB0cnVlKXtcbiAgICAgICAgICAgICAgICBnYW1lU3RhcnQgPSBmYWxzZVxuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICAvLyBjb25zb2xlSW5wdXQocXVlcnkpe1xuICAgICAgICAvLyAgICAgY29uc3QgcmVhZGxpbmUgPSByZXF1aXJlKCdyZWFkbGluZScpXG4gICAgICAgIC8vICAgICB2YXIgcmwgPSByZWFkbGluZS5jcmVhdGVJbnRlcmZhY2UocHJvY2Vzcy5zdGRpbiwgcHJvY2Vzcy5zdGRvdXQpXG4gICAgICAgIC8vICAgICByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7XG4gICAgICAgIC8vICAgICAgIHJsLnF1ZXN0aW9uKHF1ZXJ5LCAoaW5wdXQpID0+IHtcbiAgICAgICAgLy8gICAgICAgICBybC5jbG9zZSgpXG4gICAgICAgIC8vICAgICAgICAgcmVzb2x2ZShpbnB1dClcbiAgICAgICAgLy8gICAgICAgfSlcbiAgICAgICAgLy8gICAgIH0pXG4gICAgICAgIC8vICAgfSxcbiAgICAgICAgLy8gYXN5bmMgZ2V0Q29uc29sZUlucHV0KHBsYXllciwgaGlzdG9yeSl7XG4gICAgICAgIC8vICAgICBsZXQgdmFsaWRfYW5zID0gZmFsc2VcbiAgICAgICAgLy8gICAgIHdoaWxlKCF2YWxpZF9hbnMpe1xuICAgICAgICAvLyAgICAgICBsZXQgcmVzdWx0ID0gYXdhaXQgdGhpcy5jb25zb2xlSW5wdXQocGxheWVyLm5hbWUgKyAnIEVudGVyIGNvb3JkaW5hdGVzIHRvIGF0dGFjayAnKVxuICAgICAgICAvLyAgICAgICBpZih0aGlzLmNoZWNrSGlzdG9yeShyZXN1bHQsIGhpc3RvcnkpID09IGZhbHNlICYmIHRoaXMuY2hlY2tNb3ZlcyhyZXN1bHQsIHZhbGlkTW92ZXMpID09IHRydWUpe1xuICAgICAgICAvLyAgICAgICAgIGNvbnNvbGUubG9nKCd2YWxpZCcpXG4gICAgICAgIC8vICAgICAgICAgaGlzdG9yeS5wdXNoKHJlc3VsdClcbiAgICAgICAgLy8gICAgICAgICB2YWxpZF9hbnMgPSB0cnVlXG4gICAgICAgIC8vICAgICAgICAgcmV0dXJuIHJlc3VsdFxuICAgICAgICAvLyAgICAgICB9XG4gICAgICAgIC8vICAgICBlbHNlIGlmICh0aGlzLmNoZWNrSGlzdG9yeShyZXN1bHQsIGhpc3RvcnkpID09IHRydWUgfHwgdGhpcy5jaGVja01vdmVzKHJlc3VsdCwgdmFsaWRNb3ZlcykgPT0gZmFsc2Upe1xuICAgICAgICAvLyAgICAgICAgIGNvbnNvbGUubG9nKCdtdXN0IG1ha2UgdmFsaWQgbW92ZScpXG4gICAgICAgIC8vICAgICAgICAgY29udGludWVcbiAgICAgICAgLy8gICAgICAgfVxuICAgICAgICAvLyAgICAgfVxuICAgICAgICAvLyAgICAgcmV0dXJuIHJlc3VsdFxuICAgICAgICAvLyAgIH0gICBcbiAgICB9XG59XG5sZXQgbSA9IG1haW5HYW1lRnVuY3Rpb24oKVxuLy8gbS5tYWtlTW92ZXMoKVxuXG5cblxuXG5cblxuZXhwb3J0IHtzaGlwRmFjdG9yeSwgZ2FtZUJvYXJkRmFjdG9yeSwgcGxheWVyRmFjdG9yeSwgYWlGYWN0b3J5LCBtYWluR2FtZUZ1bmN0aW9ufSJdLCJuYW1lcyI6WyJfX3dlYnBhY2tfcmVxdWlyZV9fIiwiZXhwb3J0cyIsImRlZmluaXRpb24iLCJrZXkiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0Iiwib2JqIiwicHJvcCIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwiY2FsbCIsInBsYXllcjFfY29udGFpbmVyIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwicGxheWVyMl9jb250YWluZXIiLCJzdGFydEdhbWUiLCJub3RpZnlEb20iLCJzdWJtaXRCdG4iLCJpbnB1dEJhciIsImdhbWVTdGFydGVkIiwiYWRkRXZlbnRMaXN0ZW5lciIsImFzeW5jIiwibWFpbiIsInJvd3MiLCJjb2xzIiwiY29udGFpbmVyIiwicXVlcnlTZWxlY3RvckFsbCIsImZvckVhY2giLCJpbmRleCIsInN0eWxlIiwic2V0UHJvcGVydHkiLCJzZXRBdHRyaWJ1dGUiLCJpIiwiY2VsbCIsImNyZWF0ZUVsZW1lbnQiLCJpbm5lclRleHQiLCJjbGFzc05hbWUiLCJhcHBlbmRDaGlsZCIsImdhbWVib2FyZCIsImNlbGxMaXN0IiwiY29vcmRzIiwiYm9hcmQiLCJhcnIiLCJwdXNoIiwiYm94IiwiY2VsbF9saXN0X2FycmF5IiwiQXJyYXkiLCJmcm9tIiwibWlkZGxlSW5kZXgiLCJNYXRoIiwiY2VpbCIsImxlbmd0aCIsImZpcnN0SGFsZiIsInNwbGljZSIsInNlY29uZEhhbGYiLCJzcGxpdF9hcnJheSIsImFycmF5IiwiaW5uZXJIVE1MIiwiY3JlYXRlQ29vcmRpbmF0ZUFycmF5IiwiY3JlYXRlR3JpZHMiLCJnYW1lQm9hcmQiLCJwbGF5ZXJfMV9ib2FyZCIsImdyaWRJdGVtcyIsInBsYXllcl8yX2JvYXJkIiwiYXNzaWduQ2VsbHNUb1BsYXllckJvYXJkcyIsImNvbnNvbGUiLCJsb2ciLCJtYWluR2FtZUZuIiwiaGlzdG9yeSIsInZhbGlkX2FucyIsImdldGlucHV0IiwiUHJvbWlzZSIsInJlc29sdmUiLCJvbmNsaWNrIiwiaW5wdXQiLCJ2YWx1ZSIsInZhbGlkTW92ZXMiLCJzb21lIiwiZWxlIiwiaW5jbHVkZXMiLCJ4IiwicGFyc2VJbnQiLCJ5IiwicGxhY2VTaGlwIiwibWFuaXB1bGF0ZURvbSIsImFsZXJ0Iiwic2V0UGxheWVyT25lU2hpcHMiLCJ2YWxpZF9jb29yZHMiLCJyYW5kb21Db29yZCIsImZsb29yIiwicmFuZG9tIiwic2V0UGxheWVyVHdvU2hpcHMiLCJzaGlwRmFjdG9yeSIsInN1bmsiLCJub09mSGl0cyIsImhpdFNoaXAiLCJ0aGlzIiwiaXNTdW5rIiwiZ2FtZUJvYXJkRmFjdG9yeSIsInNpemVPZkJvYXJkIiwibWlzc2VkSGl0cyIsImoiLCJjb29yZCIsIkpTT04iLCJzdHJpbmdpZnkiLCJkYXRhc2V0Iiwic2hpcCIsImNvbG9yIiwic2hpcF9wbGFjZWQiLCJyb3ciLCJub09mU2hpcHMiLCJyZWNpZXZlQXR0YWNrIiwic3RhdGUiLCJub09mU3VjY2VzZnVsSGl0cyIsImNoZWNrU2hpcFN0YXR1cyIsImFsbFNoaXBzU3VuayIsInBsYXllckZhY3RvcnkiLCJuYW1lIiwid2lubmVyIiwibWFpbkdhbWVGdW5jdGlvbiIsImdhbWVTdGFydCIsInBsYXllcjFfdHVybiIsInBsYXllcjJfdHVybiIsInBsYXllcjFfaGlzdG9yeSIsInBsYXllcjJfaGlzdG9yeSIsInBsYXllcjEiLCJwbGF5ZXIyIiwiYWkiLCJ2YWx1ZXMiLCJwMV9zaGlwc1JlYWR5IiwicDJfc2hpcHNSZWFkeSIsImNoZWNrTW92ZXMiLCJhdHRhY2tDb29yZGluYXRlcyIsIm1vdmVzIiwiaXRlbSIsImNoZWNrSGlzdG9yeSIsInBsYXllckhpc3RvcnkiLCJyZWNpZXZlSW5wdXQiLCJwbGF5ZXIiLCJyZXN1bHQiLCJwcm9tcHQiLCJyZWdpc3RlclR1cm4iLCJwbGF5ZXJCb2FyZCIsImF0dGFja0lucHV0IiwibWFrZU1vdmVzIiwiZW5kR2FtZSIsInBsYXllcjFCb2FyZCIsInBsYXllcjJCb2FyZCJdLCJzb3VyY2VSb290IjoiIn0=