(()=>{"use strict";var e={d:(t,s)=>{for(var i in s)e.o(s,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:s[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{Ps:()=>g,Kp:()=>H});let t=document.querySelector(".player-1-content"),s=document.querySelector(".player-2-content");const i=document.querySelector(".start-game"),r=document.querySelector(".notify"),o=document.querySelector(".submit"),n=document.querySelector("#attack"),l=document.querySelector("#p1-missed"),a=document.querySelector("#p1-success"),c=document.querySelector("#p2-missed"),u=document.querySelector("#p2-success"),h=document.querySelector(".player-1-grid"),p=document.querySelector(".player-2-grid"),d=document.querySelector(".restart"),y={p1_missed:l,p1_success:a,p2_missed:c,p2_success:u,restartBtn:d};let m=!1;function f(){return new Promise((e=>{o.onclick=function(){let t=n.value;n.value="",e(t)}}))}i.addEventListener("click",(async function(){if(0==m){m=!0;let e=H();!function(e,i){let r=document.querySelectorAll("#main-grid");r.forEach(((e,t)=>{e.style.setProperty("--grid-rows",2),e.style.setProperty("--grid-cols",2),e.setAttribute("class",`player-${t+1}-grid`);for(let t=0;t<4;t++){let s=document.createElement("div");s.innerText=t,s.className="grid-item",e.appendChild(s)}})),t.appendChild(r[0]),s.appendChild(r[1]),function(e){let t=document.querySelectorAll(".grid-item"),s=[];e.board.forEach((e=>{e.forEach((e=>{s.push(e.box)}))}));let i=Array.from(t);const r=Math.ceil(i.length/2),o=i.splice(0,r),n=i.splice(-r),l=[];l.push(o,n),l.forEach((e=>{e.forEach(((e,t)=>{e.setAttribute("data-key",`[${s[t]}]`),e.setAttribute("data-ship",!1),e.innerHTML=`[${s[t]}]`}))}))}(g(2))}(),function(e){let t=document.querySelectorAll(".grid-item"),s=Array.from(t);const i=Math.ceil(s.length/2),r=s.splice(0,i),o=s.splice(-i);e.player_1_board.gridItems=r,e.player_2_board.gridItems=o}(e),console.log(e),await async function(e){let t=[];for(let s=0;s<2;s++){r.innerHTML=`Player 1 assign ship ${s+1}`;let i=!1;for(;!i;){let s=await f();if(e.validMoves.some((e=>e===s))&&!t.includes(s)){let r=[],o=parseInt(s[1]),n=parseInt(s[3]);r.push(o,n),e.player_1_board.placeShip(r),e.player_1_board.manipulateDom(r),t.push(s),console.log(e.player_1_board),i=!0}else alert("Example: '[0,0]' // cannot place multiple ships in same coordinates")}}r.innerHTML=""}(e),await function(e){const t=e.validMoves;let s=[];for(let i=0;i<2;i++){const i=t[Math.floor(Math.random()*t.length)];if(!s.includes(i)){let t=[],r=parseInt(i[1]),o=parseInt(i[3]);t.push(r,o),e.player_2_board.placeShip(t),e.player_2_board.manipulateDom(t),s.push(i),console.log(e.player_2_board)}}}(e),e.makeMoves()}else 1==m&&alert("game in progress")})),d.addEventListener("click",(()=>{m=!1,h.innerHTML="",p.innerHTML="",l.textContent="Missed Hits: ",c.textContent="Missed Hits: ",a.textContent="Succesfull Hits: ",u.textContent="Successfull Hits: "}));const S=(e,t,s)=>({length:e,sunk:t,noOfHits:s,hitShip:function(){this.noOfHits++,this.isSunk()},isSunk(){this.length==this.noOfHits&&(this.sunk=!0)}}),g=e=>{let t=[],s=[];for(let t=0;t<e;t++){s[t]=[];for(let i=0;i<e;i++)s[t][i]={box:[t,i]}}return{board:s,manipulateDom([e,t]){if(this.gridItems){let s=JSON.stringify([e,t]);console.log(s),this.gridItems.forEach((e=>{if(e.dataset.key===s){let t=document.createElement("img");t.setAttribute("src","../images/battleship.svg"),t.setAttribute("class","battleship"),e.appendChild(t),e.dataset.ship=!0,e.style.color="red",console.log(e)}}))}},placeShip([e,t]){let s;return this.board.forEach((i=>{i.forEach((i=>{if(i.box[0]===e&&i.box[1]===t){if("ship"in i==0)return i.ship=S(1,!1,0),s="placed ship",this.noOfShips++,i;if("ship"in i==1)return void(s="already placed ship here")}}))})),s},colorSquare(e){this.gridItems&&this.gridItems.forEach((t=>{t.dataset.key===e&&(t.style.backgroundColor="grey")}))},recieveAttack([e,s]){let i,r=[e,s],o=JSON.stringify(r);return this.board.forEach((r=>{r.forEach((r=>{r.box[0]===e&&r.box[1]===s&&"ship"in r==1?(r.ship.hitShip(),this.noOfSuccesfulHits++,this.successHits.push(o),this.pushHits(o),i=r.ship.noOfHits,console.log("hit ship")):r.box[0]===e&&r.box[1]===s&&"ship"in r==0&&(console.log("missed ship"),this.pushMisses(o),i=t)}))})),this.colorSquare(o),this.checkShipStatus(),i},checkShipStatus(){this.noOfShips>0&&this.noOfSuccesfulHits==this.noOfShips&&(console.log("All ships sunk"),this.allShipsSunk=!0)},renderMisses(e){this.missedHits.forEach((t=>{e.textContent.includes(t)||(e.textContent+=`${t}, `)}))},pushMisses(e){if(e in this.missedHits==0)this.missedHits.push(e);else if(e in this.missedHits==1)return},pushHits(e){if(e in this.successHits==0)this.successHits.push(e);else if(e in this.successHits==1)return},renderHits(e){this.successHits.forEach((t=>{e.textContent.includes(t)||(e.textContent+=`${t}, `)}))},missedHits:t,noOfShips:0,noOfSuccesfulHits:0,allShipsSunk:!1,successHits:[]}},b=e=>({name:e,winner:!1}),H=()=>{let e=!0,t=!0,s=!1,i=[],o=[],n=[],l=b("player 1"),a=b("player 2"),c=g(2),u=g(2);c.ai=!1,u.ai=!0;for(let e=0;e<c.board.length;e++)c.board[e].forEach((e=>{let t=JSON.stringify(e.box);n.push(t)}));return{player1:l,player2:a,player_1_board:c,player_2_board:u,player2_history:o,player1_turn:t,player2_turn:s,validMoves:n,p1_shipsReady:!1,p2_shipsReady:!1,checkMoves:(e,t)=>t.some((t=>t===e)),checkHistory:(e,t)=>t.some((t=>t===e)),async recieveInput(e){let t,s=!1;for(;!s;){let i=await f();if(0==this.checkHistory(i,e)&&1==this.checkMoves(i,n))return alert("valid"),e.push(i),s=!0,t=i,i;1!=this.checkHistory(i,e)&&0!=this.checkMoves(i,n)||alert("must make valid move")}return t},registerTurn(e,t){let s=[],i=parseInt(t[1]),r=parseInt(t[3]);s.push(i,r),e.recieveAttack(s),console.log(e.board)},async makeMoves(){for(;!0===e;){if(1==t){console.log("player 1 turn"),r.innerHTML="Player 1 Enter Coordinates to attack";let e=await this.recieveInput(o);this.registerTurn(u,e),u.renderMisses(y.p2_missed),u.renderHits(y.p2_success),console.log(e),t=!1,s=!0}else if(1==s){console.log("player 2 turn"),r.innerHTML="Player 2 Enter Coordinates to attack";let e=await this.recieveInput(i);this.registerTurn(c,e),c.renderMisses(y.p1_missed),c.renderHits(y.p1_success),console.log(e),s=!1,t=!0}this.endGame(c,u)}},endGame(t,s){1!=t.allShipsSunk&&1!=s.allShipsSunk||(e=!1),1==t.allShipsSunk&&alert("player 2 wins"),1==s.allShipsSunk&&alert("player 1 wins")}}};H()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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aGlwcy93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwcy93ZWJwYWNrL3J1bnRpbWUvZGVmaW5lIHByb3BlcnR5IGdldHRlcnMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcHMvd2VicGFjay9ydW50aW1lL2hhc093blByb3BlcnR5IHNob3J0aGFuZCIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwcy8uL3NyYy9kb20uanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcHMvLi9zcmMvaW5kZXguanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gVGhlIHJlcXVpcmUgc2NvcGVcbnZhciBfX3dlYnBhY2tfcmVxdWlyZV9fID0ge307XG5cbiIsIi8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb25zIGZvciBoYXJtb255IGV4cG9ydHNcbl9fd2VicGFja19yZXF1aXJlX18uZCA9IChleHBvcnRzLCBkZWZpbml0aW9uKSA9PiB7XG5cdGZvcih2YXIga2V5IGluIGRlZmluaXRpb24pIHtcblx0XHRpZihfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZGVmaW5pdGlvbiwga2V5KSAmJiAhX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIGtleSkpIHtcblx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBrZXksIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBkZWZpbml0aW9uW2tleV0gfSk7XG5cdFx0fVxuXHR9XG59OyIsIl9fd2VicGFja19yZXF1aXJlX18ubyA9IChvYmosIHByb3ApID0+IChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBwcm9wKSkiLCJpbXBvcnQgKiBhcyBtYWluR2FtZU1vZHVsZSBmcm9tICcuL2luZGV4J1xuXG5sZXQgcGxheWVyMV9jb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucGxheWVyLTEtY29udGVudCcpXG5sZXQgcGxheWVyMl9jb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucGxheWVyLTItY29udGVudCcpXG5jb25zdCBzdGFydEdhbWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc3RhcnQtZ2FtZScpXG5jb25zdCBub3RpZnlEb20gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubm90aWZ5JylcbmNvbnN0IHN1Ym1pdEJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zdWJtaXQnKVxuY29uc3QgaW5wdXRCYXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjYXR0YWNrJylcbmNvbnN0IHAxX21pc3NlZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNwMS1taXNzZWQnKVxuY29uc3QgcDFfc3VjY2VzcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNwMS1zdWNjZXNzJylcbmNvbnN0IHAyX21pc3NlZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNwMi1taXNzZWQnKVxuY29uc3QgcDJfc3VjY2VzcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNwMi1zdWNjZXNzJylcbmNvbnN0IHAxX2dyaWQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucGxheWVyLTEtZ3JpZCcpXG5jb25zdCBwMl9ncmlkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBsYXllci0yLWdyaWQnKVxuY29uc3QgcmVzdGFydEJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5yZXN0YXJ0JylcblxuY29uc3QgZG9tVHJhY2tpbmcgPSB7XG4gICAgcDFfbWlzc2VkLFxuICAgIHAxX3N1Y2Nlc3MsXG4gICAgcDJfbWlzc2VkLFxuICAgIHAyX3N1Y2Nlc3MsXG4gICAgcmVzdGFydEJ0blxufVxuXG5sZXQgZ2FtZVN0YXJ0ZWQgPSBmYWxzZVxuXG4vLyBjbGljayBzdGFydCBnYW1lXG4vLyBjcmVhdGUgZ3JpZHMgb24gc2NyZWVuXG5zdGFydEdhbWUuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBhc3luYyBmdW5jdGlvbigpICB7XG4gICAgaWYgKGdhbWVTdGFydGVkID09IGZhbHNlKXtcbiAgICAgICAgZ2FtZVN0YXJ0ZWQgPSB0cnVlXG4gICAgICAgIGxldCBtYWluID0gbWFpbkdhbWVNb2R1bGUubWFpbkdhbWVGdW5jdGlvbigpXG4gICAgICAgIGNyZWF0ZUdyaWRzKDIsMilcbiAgICAgICAgYXNzaWduQ2VsbHNUb1BsYXllckJvYXJkcyhtYWluKVxuICAgICAgICBjb25zb2xlLmxvZyhtYWluKVxuICAgICAgICBhd2FpdCBzZXRQbGF5ZXJPbmVTaGlwcyhtYWluKVxuICAgICAgICBhd2FpdCBzZXRQbGF5ZXJUd29TaGlwcyhtYWluKVxuICAgICAgICBtYWluLm1ha2VNb3ZlcygpXG4gICAgfVxuICAgIGVsc2UgaWYgKGdhbWVTdGFydGVkID09IHRydWUpe1xuICAgICAgICBhbGVydCgnZ2FtZSBpbiBwcm9ncmVzcycpXG4gICAgfVxuXG59KVxuXG5yZXN0YXJ0QnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICAgIC8vY2xlYW5VcFxuICAgIGdhbWVTdGFydGVkID0gZmFsc2VcbiAgICBjbGVhblVwKClcbiAgICBcbn0pXG5cbmZ1bmN0aW9uIGNsZWFuVXAoKXtcbiAgICBwMV9ncmlkLmlubmVySFRNTCA9IFwiXCJcbiAgICBwMl9ncmlkLmlubmVySFRNTCA9IFwiXCJcbiAgICBwMV9taXNzZWQudGV4dENvbnRlbnQgPSBcIk1pc3NlZCBIaXRzOiBcIlxuICAgIHAyX21pc3NlZC50ZXh0Q29udGVudCA9IFwiTWlzc2VkIEhpdHM6IFwiXG4gICAgcDFfc3VjY2Vzcy50ZXh0Q29udGVudCA9IFwiU3VjY2VzZnVsbCBIaXRzOiBcIlxuICAgIHAyX3N1Y2Nlc3MudGV4dENvbnRlbnQgPSBcIlN1Y2Nlc3NmdWxsIEhpdHM6IFwiXG59XG5cblxuXG5mdW5jdGlvbiByZW5kZXJNaXNzZXMoZ2FtZWJvYXJkLCBtaXNzZWRIaXRTZWxlY3Rvcil7XG4gICAgZ2FtZWJvYXJkLm1pc3NlZEhpdHMuZm9yRWFjaChjb29yZCA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKGNvb3JkKVxuICAgICAgICBtaXNzZWRIaXRTZWxlY3Rvci50ZXh0Q29udGVudCArPSBjb29yZFxuICAgIH0pXG59XG5cblxuLy8gYXNrIHBsYXllcjEgdG8gYXNzaWduIGhpcyBzaGlwc1xuYXN5bmMgZnVuY3Rpb24gc2V0UGxheWVyT25lU2hpcHMobWFpbkdhbWVGbil7XG4gICAgbGV0IGhpc3RvcnkgPSBbXVxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMjsgaSsrKXtcbiAgICAgICAgbm90aWZ5RG9tLmlubmVySFRNTCA9IGBQbGF5ZXIgMSBhc3NpZ24gc2hpcCAke2kgKyAxfWBcbiAgICAgICAgbGV0IHZhbGlkX2FucyA9IGZhbHNlXG4gICAgICAgIHdoaWxlKCF2YWxpZF9hbnMpe1xuICAgICAgICAgICAgbGV0IGdldGlucHV0ID0gYXdhaXQgaW5wdXRDbGljaygpXG4gICAgICAgICAgICBpZiAobWFpbkdhbWVGbi52YWxpZE1vdmVzLnNvbWUoZWxlID0+IGVsZSA9PT0gZ2V0aW5wdXQpICYmICFoaXN0b3J5LmluY2x1ZGVzKGdldGlucHV0KSl7XG4gICAgICAgICAgICAgICAgbGV0IGNvb3JkcyA9IFtdXG4gICAgICAgICAgICAgICAgbGV0IHggPSBwYXJzZUludChnZXRpbnB1dFsxXSlcbiAgICAgICAgICAgICAgICBsZXQgeSA9IHBhcnNlSW50KGdldGlucHV0WzNdKVxuICAgICAgICAgICAgICAgIGNvb3Jkcy5wdXNoKHgsIHkpXG4gICAgICAgICAgICAgICAgbWFpbkdhbWVGbi5wbGF5ZXJfMV9ib2FyZC5wbGFjZVNoaXAoY29vcmRzKVxuICAgICAgICAgICAgICAgIG1haW5HYW1lRm4ucGxheWVyXzFfYm9hcmQubWFuaXB1bGF0ZURvbShjb29yZHMpXG4gICAgICAgICAgICAgICAgaGlzdG9yeS5wdXNoKGdldGlucHV0KVxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKG1haW5HYW1lRm4ucGxheWVyXzFfYm9hcmQpXG5cbiAgICAgICAgICAgICAgICB2YWxpZF9hbnMgPSB0cnVlXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBhbGVydCgnRXhhbXBsZTogXFwnWzAsMF1cXCcgLy8gY2Fubm90IHBsYWNlIG11bHRpcGxlIHNoaXBzIGluIHNhbWUgY29vcmRpbmF0ZXMnKVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIG5vdGlmeURvbS5pbm5lckhUTUwgPSBcIlwiO1xufVxuXG5mdW5jdGlvbiBpbnB1dENsaWNrKCl7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gICAgICAgIHN1Ym1pdEJ0bi5vbmNsaWNrID0gZnVuY3Rpb24gKCl7XG4gICAgICAgICAgICBsZXQgaW5wdXQgPSBpbnB1dEJhci52YWx1ZVxuICAgICAgICAgICAgaW5wdXRCYXIudmFsdWUgPSBcIlwiO1xuICAgICAgICAgICAgcmVzb2x2ZShpbnB1dClcbiAgICAgICAgfVxuICAgIH0pXG59XG5cblxuLy8gYXNzaWduIHBsYXllcjIgc2hpcHNcblxuZnVuY3Rpb24gc2V0UGxheWVyVHdvU2hpcHMobWFpbkdhbWVGbil7XG4gICAgY29uc3QgdmFsaWRfY29vcmRzID0gbWFpbkdhbWVGbi52YWxpZE1vdmVzXG4gICAgbGV0IGhpc3RvcnkgPSBbXVxuICAgIFxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMjsgaSsrKXtcbiAgICAgICAgY29uc3QgcmFuZG9tQ29vcmQgPSB2YWxpZF9jb29yZHNbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogdmFsaWRfY29vcmRzLmxlbmd0aCldXG4gICAgICAgIGlmICghaGlzdG9yeS5pbmNsdWRlcyhyYW5kb21Db29yZCkpe1xuICAgICAgICAgICAgbGV0IGNvb3JkcyA9IFtdXG4gICAgICAgICAgICBsZXQgeCA9IHBhcnNlSW50KHJhbmRvbUNvb3JkWzFdKVxuICAgICAgICAgICAgbGV0IHkgPSBwYXJzZUludChyYW5kb21Db29yZFszXSlcbiAgICAgICAgICAgIGNvb3Jkcy5wdXNoKHgsIHkpXG4gICAgICAgICAgICBtYWluR2FtZUZuLnBsYXllcl8yX2JvYXJkLnBsYWNlU2hpcChjb29yZHMpXG4gICAgICAgICAgICBtYWluR2FtZUZuLnBsYXllcl8yX2JvYXJkLm1hbmlwdWxhdGVEb20oY29vcmRzKVxuICAgICAgICAgICAgaGlzdG9yeS5wdXNoKHJhbmRvbUNvb3JkKVxuICAgICAgICAgICAgY29uc29sZS5sb2cobWFpbkdhbWVGbi5wbGF5ZXJfMl9ib2FyZClcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNvbnRpbnVlXG4gICAgICAgIH1cbiAgICB9XG5cbn1cblxuXG4vLyB3aGVuIGFsbCBzaGlwcyBhcmUgYXNzaWduZWQgc3RhcnQgdG8gbWFrZSBNb3Zlc1xuXG5cblxuXG5mdW5jdGlvbiBjcmVhdGVHcmlkcyhyb3dzLCBjb2xzKXsgICAgXG4gICAgbGV0IGNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJyNtYWluLWdyaWQnKVxuICAgIGNvbnRhaW5lci5mb3JFYWNoKChvYmosIGluZGV4KSA9PiB7XG4gICAgICAgIG9iai5zdHlsZS5zZXRQcm9wZXJ0eSgnLS1ncmlkLXJvd3MnLCByb3dzKVxuICAgICAgICBvYmouc3R5bGUuc2V0UHJvcGVydHkoJy0tZ3JpZC1jb2xzJywgY29scylcbiAgICAgICAgb2JqLnNldEF0dHJpYnV0ZSgnY2xhc3MnLCBgcGxheWVyLSR7aW5kZXggKyAxfS1ncmlkYClcblxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IChyb3dzICogY29scyk7IGkrKyl7XG4gICAgICAgICAgICBsZXQgY2VsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpXG4gICAgICAgICAgICBjZWxsLmlubmVyVGV4dCA9IChpKVxuICAgICAgICAgICAgY2VsbC5jbGFzc05hbWUgPSAnZ3JpZC1pdGVtJ1xuICAgICAgICAgICAgb2JqLmFwcGVuZENoaWxkKGNlbGwpXG4gICAgICAgIH1cbiAgICB9KVxuXG4gICAgcGxheWVyMV9jb250YWluZXIuYXBwZW5kQ2hpbGQoY29udGFpbmVyWzBdKVxuICAgIHBsYXllcjJfY29udGFpbmVyLmFwcGVuZENoaWxkKGNvbnRhaW5lclsxXSlcbiAgICBsZXQgcmVmZXJlbmNlQm9hcmQgPSBtYWluR2FtZU1vZHVsZS5nYW1lQm9hcmRGYWN0b3J5KDIpXG4gICAgY3JlYXRlQ29vcmRpbmF0ZUFycmF5KHJlZmVyZW5jZUJvYXJkKSAgIFxufVxuXG5mdW5jdGlvbiBjcmVhdGVDb29yZGluYXRlQXJyYXkoZ2FtZWJvYXJkKXtcbiAgICAvLyBjcmVhdGVzIGNvb3JkaW5hdGVzIHRvIGFzc2lnbiB0byBlYWNoIGNlbGxzIGRhdGEgYXR0cmlidXRlIGFuZCBpbm5lciBIVE1MXG4gICAgbGV0IGNlbGxMaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmdyaWQtaXRlbScpXG4gICAgbGV0IGNvb3JkcyA9IFtdO1xuICAgIGdhbWVib2FyZC5ib2FyZC5mb3JFYWNoKGFyciA9PiB7XG4gICAgICAgIGFyci5mb3JFYWNoKG9iaiA9PiB7XG4gICAgICAgICAgICBjb29yZHMucHVzaChvYmouYm94KVxuICAgICAgICB9KVxuICAgIH0pXG5cbiAgICBsZXQgY2VsbF9saXN0X2FycmF5ID0gQXJyYXkuZnJvbShjZWxsTGlzdClcbiAgICBjb25zdCBtaWRkbGVJbmRleCA9IE1hdGguY2VpbChjZWxsX2xpc3RfYXJyYXkubGVuZ3RoIC8gMilcbiAgICBjb25zdCBmaXJzdEhhbGYgPSBjZWxsX2xpc3RfYXJyYXkuc3BsaWNlKDAsIG1pZGRsZUluZGV4KVxuICAgIGNvbnN0IHNlY29uZEhhbGYgPSBjZWxsX2xpc3RfYXJyYXkuc3BsaWNlKC1taWRkbGVJbmRleClcblxuICAgIGNvbnN0IHNwbGl0X2FycmF5ID0gW11cbiAgICBzcGxpdF9hcnJheS5wdXNoKGZpcnN0SGFsZiwgc2Vjb25kSGFsZilcblxuICAgIFxuICAgIHNwbGl0X2FycmF5LmZvckVhY2goYXJyYXkgPT4ge1xuICAgICAgICBhcnJheS5mb3JFYWNoKChjZWxsLCBpbmRleCkgPT4ge1xuICAgICAgICAgICAgY2VsbC5zZXRBdHRyaWJ1dGUoJ2RhdGEta2V5JywgYFske2Nvb3Jkc1tpbmRleF19XWApXG4gICAgICAgICAgICBjZWxsLnNldEF0dHJpYnV0ZSgnZGF0YS1zaGlwJywgZmFsc2UpXG4gICAgICAgICAgICBjZWxsLmlubmVySFRNTCA9IGBbJHtjb29yZHNbaW5kZXhdfV1gIFxuICAgICAgICB9KVxuICAgIH0pXG59XG5cbmZ1bmN0aW9uIGFzc2lnbkNlbGxzVG9QbGF5ZXJCb2FyZHMoZ2FtZUJvYXJkKXtcbiAgICBsZXQgY2VsbExpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuZ3JpZC1pdGVtJylcbiAgICBsZXQgY2VsbF9saXN0X2FycmF5ID0gQXJyYXkuZnJvbShjZWxsTGlzdClcbiAgICBjb25zdCBtaWRkbGVJbmRleCA9IE1hdGguY2VpbChjZWxsX2xpc3RfYXJyYXkubGVuZ3RoIC8gMilcbiAgICBjb25zdCBmaXJzdEhhbGYgPSBjZWxsX2xpc3RfYXJyYXkuc3BsaWNlKDAsIG1pZGRsZUluZGV4KVxuICAgIGNvbnN0IHNlY29uZEhhbGYgPSBjZWxsX2xpc3RfYXJyYXkuc3BsaWNlKC1taWRkbGVJbmRleClcblxuICAgIGdhbWVCb2FyZC5wbGF5ZXJfMV9ib2FyZC5ncmlkSXRlbXMgPSBmaXJzdEhhbGZcbiAgICBnYW1lQm9hcmQucGxheWVyXzJfYm9hcmQuZ3JpZEl0ZW1zID0gc2Vjb25kSGFsZlxuXG5cbn1cblxuXG5cblxuZXhwb3J0IHtcbiAgICBjcmVhdGVHcmlkcyxcbiAgICBwbGF5ZXIxX2NvbnRhaW5lcixcbiAgICBwbGF5ZXIyX2NvbnRhaW5lcixcbiAgICBjcmVhdGVDb29yZGluYXRlQXJyYXksXG4gICAgaW5wdXRDbGljayxcbiAgICBub3RpZnlEb20sXG4gICAgZG9tVHJhY2tpbmcsXG4gICAgcmVuZGVyTWlzc2VzLFxuICAgIGdhbWVTdGFydGVkXG59IiwiaW1wb3J0ICogYXMgZG9tIGZyb20gJy4vZG9tJ1xuXG5jb25zdCBzaGlwRmFjdG9yeSA9IChsZW5ndGgsIHN1bmssIG5vT2ZIaXRzKSA9PiB7XG4gICAgXG4gICAgZnVuY3Rpb24gaGl0U2hpcCgpe1xuICAgICAgICB0aGlzLm5vT2ZIaXRzKytcbiAgICAgICAgdGhpcy5pc1N1bmsoKVxuICAgIH1cbiAgICBcbiAgICByZXR1cm4geyBsZW5ndGgsIFxuICAgICAgICAgICAgIHN1bmssIFxuICAgICAgICAgICAgIG5vT2ZIaXRzLCBcbiAgICAgICAgICAgICBoaXRTaGlwLCBcbiAgICAgICAgICAgICBpc1N1bmsoKXtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5sZW5ndGggPT0gdGhpcy5ub09mSGl0cyl7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3VuayA9IHRydWVcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxufVxuXG5cbmNvbnN0IGdhbWVCb2FyZEZhY3RvcnkgPSAoc2l6ZU9mQm9hcmQpID0+IHtcbiAgIFxuICAgIGxldCBub09mU2hpcHMgPSAwXG4gICAgbGV0IG5vT2ZTdWNjZXNmdWxIaXRzID0gMCBcbiAgICBsZXQgbWlzc2VkSGl0cyA9IFtdXG4gICAgbGV0IHN1Y2Nlc3NIaXRzID0gW10gXG4gICAgbGV0IGJvYXJkID0gW11cbiAgICBsZXQgYWxsU2hpcHNTdW5rID0gZmFsc2VcblxuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzaXplT2ZCb2FyZDsgaSsrKXtcbiAgICBib2FyZFtpXSA9IFtdXG4gICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgc2l6ZU9mQm9hcmQ7IGorKyl7XG4gICAgICAgICAgICBib2FyZFtpXVtqXSA9IHtib3g6IFtpLCBqXX1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICAgIGJvYXJkLFxuICAgICAgICBtYW5pcHVsYXRlRG9tKFt4LHldKXtcbiAgICAgICAgICAgIC8vIHNldHMgY2VsbHMgZGF0YSBzaGlwIGF0dHJpYnV0ZSB0byB0cnVlIHdoZW4gc2hpcCBpcyBwbGFjZWQgaW4gaXQuXG4gICAgICAgICAgICBpZiAodGhpcy5ncmlkSXRlbXMpe1xuICAgICAgICAgICAgICAgIGxldCBjb29yZCA9IEpTT04uc3RyaW5naWZ5KFt4LHldKVxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGNvb3JkKVxuICAgICAgICAgICAgICAgIHRoaXMuZ3JpZEl0ZW1zLmZvckVhY2goY2VsbCA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjZWxsLmRhdGFzZXQua2V5ID09PSBjb29yZCl7XG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgYm9hdEltZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpXG4gICAgICAgICAgICAgICAgICAgICAgICBib2F0SW1nLnNldEF0dHJpYnV0ZSgnc3JjJywgJy4uL2ltYWdlcy9iYXR0bGVzaGlwLnN2ZycpXG4gICAgICAgICAgICAgICAgICAgICAgICBib2F0SW1nLnNldEF0dHJpYnV0ZSgnY2xhc3MnLCAnYmF0dGxlc2hpcCcpXG4gICAgICAgICAgICAgICAgICAgICAgICBjZWxsLmFwcGVuZENoaWxkKGJvYXRJbWcpXG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGNlbGwuZGF0YXNldC5zaGlwID0gdHJ1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgY2VsbC5zdHlsZS5jb2xvciA9ICdyZWQnXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhjZWxsKVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgcGxhY2VTaGlwKFt4LCB5XSl7XG4gICAgICAgICAgICAvLyBwbGFjZXMgYSBzaGlwIG9iamVjdCBhdCBzcGVjaWZpZWQgY29vcmRpbmF0ZXNcbiAgICAgICAgICAgIGxldCBzaGlwX3BsYWNlZDtcbiAgICAgICAgICAgIHRoaXMuYm9hcmQuZm9yRWFjaChyb3cgPT4ge1xuICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCd0aGVzZSBhcmUgdGhlIHJvd3Mgb2YgYXJyYXlzICcsIHJvdylcbiAgICAgICAgICAgICAgICByb3cuZm9yRWFjaChvYmogPT4ge1xuICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygndGhlc2UgYXJlIHRoZSBvYmplY3RzIGluIHJvd3MnLCBvYmopXG4gICAgICAgICAgICAgICAgICAgIGlmKG9iai5ib3hbMF0gPT09IHggJiYgb2JqLmJveFsxXSA9PT0geSl7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoJ3NoaXAnIGluIG9iaiA9PT0gZmFsc2Upe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5zaGlwID0gc2hpcEZhY3RvcnkoMSwgZmFsc2UsIDApXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2cob2JqKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNoaXBfcGxhY2VkID0gJ3BsYWNlZCBzaGlwJ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubm9PZlNoaXBzKytcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2JqXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICgnc2hpcCcgaW4gb2JqID09PSB0cnVlKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaGlwX3BsYWNlZCA9ICdhbHJlYWR5IHBsYWNlZCBzaGlwIGhlcmUnXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgcmV0dXJuIHNoaXBfcGxhY2VkXG4gICAgICAgIH0sXG4gICAgICAgIGNvbG9yU3F1YXJlKGNvb3JkaW5hdGVzKXtcbiAgICAgICAgICAgIGlmICh0aGlzLmdyaWRJdGVtcyl7XG4gICAgICAgICAgICAgICAgdGhpcy5ncmlkSXRlbXMuZm9yRWFjaChjZWxsID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNlbGwuZGF0YXNldC5rZXkgPT09IGNvb3JkaW5hdGVzKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNlbGwuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gJ2dyZXknXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICByZWNpZXZlQXR0YWNrKFt4LCB5XSl7XG5cbiAgICAgICAgICAgIC8vIHR1cm4gY29vcmQgdG8gc3RyaW5nIHRvIHNhdmUgbWlzc2VkIGhpdHMgYW5kIHN1Y2Nlc3NmdWwgaGl0cyBpbiBhcnJheSB0byBkaXNwbGF5IGxhdGVyXG4gICAgICAgICAgICBsZXQgY29vcmQgPSBbeCwgeV1cbiAgICAgICAgICAgIGxldCBjb29yZFRvU3RyaW5nID0gSlNPTi5zdHJpbmdpZnkoY29vcmQpXG4gICAgICAgICAgICAvL1xuICAgICAgICAgICAgXG5cbiAgICAgICAgICAgIGxldCBzdGF0ZTtcbiAgICAgICAgICAgIHRoaXMuYm9hcmQuZm9yRWFjaChyb3cgPT4ge1xuICAgICAgICAgICAgICAgIHJvdy5mb3JFYWNoKG9iaiA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChvYmouYm94WzBdID09PSB4ICYmIG9iai5ib3hbMV0gPT09IHkgJiYgJ3NoaXAnIGluIG9iaiA9PT0gdHJ1ZSl7XG4gICAgICAgICAgICAgICAgICAgICAgICBvYmouc2hpcC5oaXRTaGlwKClcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubm9PZlN1Y2Nlc2Z1bEhpdHMrK1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zdWNjZXNzSGl0cy5wdXNoKGNvb3JkVG9TdHJpbmcpXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnB1c2hIaXRzKGNvb3JkVG9TdHJpbmcpXG4gICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZSA9IG9iai5zaGlwLm5vT2ZIaXRzXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnaGl0IHNoaXAnKVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYob2JqLmJveFswXSA9PT0geCAmJiBvYmouYm94WzFdID09PSB5ICYmICdzaGlwJyBpbiBvYmogPT09IGZhbHNlKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdtaXNzZWQgc2hpcCcpXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnB1c2hNaXNzZXMoY29vcmRUb1N0cmluZylcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlID0gbWlzc2VkSGl0c1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH0pXG5cbiAgICAgICAgICAgIHRoaXMuY29sb3JTcXVhcmUoY29vcmRUb1N0cmluZylcbiAgICAgICAgICAgIHRoaXMuY2hlY2tTaGlwU3RhdHVzKClcbiAgICAgICAgICAgIHJldHVybiBzdGF0ZVxuICAgICAgICB9LFxuICAgICAgICBjaGVja1NoaXBTdGF0dXMoKXtcbiAgICAgICAgICAgIGlmICh0aGlzLm5vT2ZTaGlwcyA+IDAgJiYgdGhpcy5ub09mU3VjY2VzZnVsSGl0cyA9PSB0aGlzLm5vT2ZTaGlwcyl7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0FsbCBzaGlwcyBzdW5rJylcbiAgICAgICAgICAgICAgICB0aGlzLmFsbFNoaXBzU3VuayA9IHRydWVcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgcmVuZGVyTWlzc2VzKG1pc3NlZEhpdFNlbGVjdG9yKXtcbiAgICAgICAgICAgIHRoaXMubWlzc2VkSGl0cy5mb3JFYWNoKGNvb3JkID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoIW1pc3NlZEhpdFNlbGVjdG9yLnRleHRDb250ZW50LmluY2x1ZGVzKGNvb3JkKSl7XG4gICAgICAgICAgICAgICAgICAgIG1pc3NlZEhpdFNlbGVjdG9yLnRleHRDb250ZW50ICs9IGAke2Nvb3JkfSwgYFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0sXG4gICAgICAgIHB1c2hNaXNzZXMoY29vcmQpe1xuICAgICAgICAgICAgaWYgKGNvb3JkIGluIHRoaXMubWlzc2VkSGl0cyA9PSBmYWxzZSl7XG4gICAgICAgICAgICAgICAgdGhpcy5taXNzZWRIaXRzLnB1c2goY29vcmQpXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChjb29yZCBpbiB0aGlzLm1pc3NlZEhpdHMgPT0gdHJ1ZSl7XG4gICAgICAgICAgICAgICAgcmV0dXJuXG4gICAgICAgICAgICB9IFxuICAgICAgICB9LFxuICAgICAgICBwdXNoSGl0cyhjb29yZCl7XG4gICAgICAgICAgICBpZiAoY29vcmQgaW4gdGhpcy5zdWNjZXNzSGl0cyA9PSBmYWxzZSl7XG4gICAgICAgICAgICAgICAgdGhpcy5zdWNjZXNzSGl0cy5wdXNoKGNvb3JkKVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoY29vcmQgaW4gdGhpcy5zdWNjZXNzSGl0cyA9PSB0cnVlKXtcbiAgICAgICAgICAgICAgICByZXR1cm5cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgcmVuZGVySGl0cyhzdWNjZXNzSGl0c1NlbGVjdG9yKXtcbiAgICAgICAgICAgIHRoaXMuc3VjY2Vzc0hpdHMuZm9yRWFjaChjb29yZCA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKCFzdWNjZXNzSGl0c1NlbGVjdG9yLnRleHRDb250ZW50LmluY2x1ZGVzKGNvb3JkKSl7XG4gICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3NIaXRzU2VsZWN0b3IudGV4dENvbnRlbnQgKz0gYCR7Y29vcmR9LCBgXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgfSxcbiAgICAgICAgbWlzc2VkSGl0cyxcbiAgICAgICAgbm9PZlNoaXBzLFxuICAgICAgICBub09mU3VjY2VzZnVsSGl0cyxcbiAgICAgICAgYWxsU2hpcHNTdW5rLFxuICAgICAgICBzdWNjZXNzSGl0c1xuICAgIH1cbn1cblxuXG5jb25zdCBwbGF5ZXJGYWN0b3J5ID0gKG5hbWUpID0+IHtcbiAgICBsZXQgd2lubmVyID0gZmFsc2VcblxuICAgIHJldHVybiB7XG4gICAgICAgIG5hbWUsXG4gICAgICAgIHdpbm5lclxuICAgIH1cbn1cblxuY29uc3QgYWlGYWN0b3J5ID0gKG5hbWUpID0+IHtcbiAgICBsZXQgd2lubmVyID0gZmFsc2VcbiAgICByZXR1cm4ge1xuICAgICAgICBuYW1lLFxuICAgICAgICB3aW5uZXIsICBcbiAgICB9XG59XG5cbmNvbnN0IG1haW5HYW1lRnVuY3Rpb24gPSAoKSA9PiB7XG4gICAgbGV0IGdhbWVTdGFydCA9IHRydWVcbiAgICBsZXQgcGxheWVyMV90dXJuID0gdHJ1ZVxuICAgIGxldCBwbGF5ZXIyX3R1cm4gPSBmYWxzZVxuXG4gICAgbGV0IHBsYXllcjFfaGlzdG9yeSA9IFtdXG4gICAgbGV0IHBsYXllcjJfaGlzdG9yeSA9IFtdXG5cbiAgICBsZXQgcDFfc2hpcHNSZWFkeSA9IGZhbHNlXG4gICAgbGV0IHAyX3NoaXBzUmVhZHkgPSBmYWxzZVxuXG4gICAgbGV0IHZhbGlkTW92ZXMgPSBbXVxuXG5cbiAgICBsZXQgcGxheWVyMSA9IHBsYXllckZhY3RvcnkoJ3BsYXllciAxJylcbiAgICBsZXQgcGxheWVyMiA9IHBsYXllckZhY3RvcnkoJ3BsYXllciAyJylcblxuICAgIGxldCBwbGF5ZXJfMV9ib2FyZCA9IGdhbWVCb2FyZEZhY3RvcnkoMilcbiAgICBsZXQgcGxheWVyXzJfYm9hcmQgPSBnYW1lQm9hcmRGYWN0b3J5KDIpXG4gICAgcGxheWVyXzFfYm9hcmQuYWkgPSBmYWxzZVxuICAgIHBsYXllcl8yX2JvYXJkLmFpID0gdHJ1ZVxuXG5cbiAgICAvLyBmb3IgbG9vcCB0YWtlcyBhbGwgdGhlIGF2YWlsYWJsZSBtb3ZlcyBhbmQgcHV0cyB0aGVtIGluXG4gICAgLy8gYW4gYXJyYXkgYXMgc3RyaW5nIGFycmF5cy4gXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwbGF5ZXJfMV9ib2FyZC5ib2FyZC5sZW5ndGg7IGkrKyl7XG4gICAgICAgIHBsYXllcl8xX2JvYXJkLmJvYXJkW2ldLmZvckVhY2gob2JqID0+IHtcbiAgICAgICAgICAgIGxldCB2YWx1ZXMgPSBKU09OLnN0cmluZ2lmeShvYmouYm94KVxuICAgICAgICAgICAgdmFsaWRNb3Zlcy5wdXNoKHZhbHVlcylcbiAgICAgICAgfSlcbiAgICB9XG5cblxuICAgIHJldHVybiB7IFxuICAgICAgICBwbGF5ZXIxLFxuICAgICAgICBwbGF5ZXIyLFxuICAgICAgICBwbGF5ZXJfMV9ib2FyZCxcbiAgICAgICAgcGxheWVyXzJfYm9hcmQsXG4gICAgICAgIHBsYXllcjJfaGlzdG9yeSxcbiAgICAgICAgcGxheWVyMV90dXJuLFxuICAgICAgICBwbGF5ZXIyX3R1cm4sXG4gICAgICAgIHZhbGlkTW92ZXMsXG4gICAgICAgIHAxX3NoaXBzUmVhZHksXG4gICAgICAgIHAyX3NoaXBzUmVhZHksXG4gICAgICAgIGNoZWNrTW92ZXMoYXR0YWNrQ29vcmRpbmF0ZXMsIG1vdmVzKXtcbiAgICAgICAgICAgIC8vIGNoZWNrIGlmIG1vdmVzIGNhbiBiZSBtYWRlIGluIHRlcm1zIG9mIHBvc3NpYmxlIGNvb3JkaW5hdGVzIHRvIGNob29zZSBmcm9tXG4gICAgICAgICAgICBsZXQgY29udGFpbnMgPSBtb3Zlcy5zb21lKGl0ZW0gPT4gaXRlbSA9PT0gYXR0YWNrQ29vcmRpbmF0ZXMpXG4gICAgICAgICAgICByZXR1cm4gY29udGFpbnNcbiAgICAgICAgfSxcbiAgICAgICAgY2hlY2tIaXN0b3J5KGF0dGFja0Nvb3JkaW5hdGVzLCBwbGF5ZXJIaXN0b3J5KXtcbiAgICAgICAgICAgIC8vIGNoZWNrIGlmIHBsYXllciBhbHJlYWR5IG1hZGUgYSBtb3ZlIHRvIHRoYXQgY29vcmRpbmF0ZVxuICAgICAgICAgICAgLy8gbGV0IGl0ZW0gPSBKU09OLnN0cmluZ2lmeShhdHRhY2tDb29yZGluYXRlcylcbiAgICAgICAgICAgIGxldCBjb250YWlucyA9IHBsYXllckhpc3Rvcnkuc29tZShlbGUgPT4gZWxlID09PSBhdHRhY2tDb29yZGluYXRlcylcbiAgICAgICAgICAgIHJldHVybiBjb250YWluc1xuXG4gICAgICAgIH0sXG4gICAgICAgIGFzeW5jIHJlY2lldmVJbnB1dChoaXN0b3J5KXtcbiAgICAgICAgICAgIGxldCByZXN1bHQ7XG4gICAgICAgICAgICBsZXQgdmFsaWRfYW5zID0gZmFsc2VcbiAgICAgICAgICAgIHdoaWxlKCF2YWxpZF9hbnMpe1xuICAgICAgICAgICAgICAgIGxldCBpbnB1dCA9IGF3YWl0IGRvbS5pbnB1dENsaWNrKClcbiAgICAgICAgICAgICAgICBpZih0aGlzLmNoZWNrSGlzdG9yeShpbnB1dCwgaGlzdG9yeSkgPT0gZmFsc2UgJiYgdGhpcy5jaGVja01vdmVzKGlucHV0LCB2YWxpZE1vdmVzKSA9PSB0cnVlKXtcbiAgICAgICAgICAgICAgICAgICAgYWxlcnQoJ3ZhbGlkJylcbiAgICAgICAgICAgICAgICAgICAgaGlzdG9yeS5wdXNoKGlucHV0KVxuICAgICAgICAgICAgICAgICAgICB2YWxpZF9hbnMgPSB0cnVlXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IGlucHV0XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBpbnB1dFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmICh0aGlzLmNoZWNrSGlzdG9yeShpbnB1dCwgaGlzdG9yeSkgPT0gdHJ1ZSB8fCB0aGlzLmNoZWNrTW92ZXMoaW5wdXQsIHZhbGlkTW92ZXMpID09IGZhbHNlKXtcbiAgICAgICAgICAgICAgICAgICAgYWxlcnQoJ211c3QgbWFrZSB2YWxpZCBtb3ZlJylcbiAgICAgICAgICAgICAgICAgICAgY29udGludWVcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0XG4gICAgICAgIH0sXG4gICAgICAgIHJlZ2lzdGVyVHVybihwbGF5ZXJCb2FyZCwgYXR0YWNrSW5wdXQpe1xuICAgICAgICAgICAgbGV0IGFyciA9IFtdO1xuICAgICAgICAgICAgbGV0IHggPSBwYXJzZUludChhdHRhY2tJbnB1dFsxXSk7XG4gICAgICAgICAgICBsZXQgeSA9IHBhcnNlSW50KGF0dGFja0lucHV0WzNdKTtcbiAgICAgICAgICAgIGFyci5wdXNoKHgsIHkpO1xuICAgICAgICAgICAgcGxheWVyQm9hcmQucmVjaWV2ZUF0dGFjayhhcnIpO1xuICAgICAgICAgICAgY29uc29sZS5sb2cocGxheWVyQm9hcmQuYm9hcmQpXG4gICAgICAgICAgICB9LFxuICAgICAgICBhc3luYyBtYWtlTW92ZXMoKXtcbiAgICAgICAgICAgIHdoaWxlKGdhbWVTdGFydCA9PT0gdHJ1ZSl7XG4gICAgICAgICAgICAgICAgaWYocGxheWVyMV90dXJuID09IHRydWUpe1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygncGxheWVyIDEgdHVybicpXG4gICAgICAgICAgICAgICAgICAgIC8vIGxldCBpbnB1dCA9IHRoaXMucmVjaWV2ZUlucHV0KHBsYXllcjEsIHBsYXllcjJfaGlzdG9yeSlcbiAgICAgICAgICAgICAgICAgICAgZG9tLm5vdGlmeURvbS5pbm5lckhUTUwgPSBcIlBsYXllciAxIEVudGVyIENvb3JkaW5hdGVzIHRvIGF0dGFja1wiXG4gICAgICAgICAgICAgICAgICAgIGxldCBpbnB1dCA9IGF3YWl0IHRoaXMucmVjaWV2ZUlucHV0KHBsYXllcjJfaGlzdG9yeSlcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZWdpc3RlclR1cm4ocGxheWVyXzJfYm9hcmQsIGlucHV0KVxuICAgICAgICAgICAgICAgICAgICBwbGF5ZXJfMl9ib2FyZC5yZW5kZXJNaXNzZXMoZG9tLmRvbVRyYWNraW5nLnAyX21pc3NlZClcbiAgICAgICAgICAgICAgICAgICAgcGxheWVyXzJfYm9hcmQucmVuZGVySGl0cyhkb20uZG9tVHJhY2tpbmcucDJfc3VjY2VzcylcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coaW5wdXQpXG4gICAgICAgICAgICAgICAgICAgIHBsYXllcjFfdHVybiA9IGZhbHNlXG4gICAgICAgICAgICAgICAgICAgIHBsYXllcjJfdHVybiA9IHRydWVcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAocGxheWVyMl90dXJuID09IHRydWUpe1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygncGxheWVyIDIgdHVybicpXG4gICAgICAgICAgICAgICAgICAgIC8vIGxldCBpbnB1dCA9IHRoaXMucmVjaWV2ZUlucHV0KHBsYXllcjIsIHBsYXllcjFfaGlzdG9yeSlcbiAgICAgICAgICAgICAgICAgICAgZG9tLm5vdGlmeURvbS5pbm5lckhUTUwgPSBcIlBsYXllciAyIEVudGVyIENvb3JkaW5hdGVzIHRvIGF0dGFja1wiXG4gICAgICAgICAgICAgICAgICAgIGxldCBpbnB1dCA9IGF3YWl0IHRoaXMucmVjaWV2ZUlucHV0KHBsYXllcjFfaGlzdG9yeSlcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZWdpc3RlclR1cm4ocGxheWVyXzFfYm9hcmQsIGlucHV0KVxuICAgICAgICAgICAgICAgICAgICBwbGF5ZXJfMV9ib2FyZC5yZW5kZXJNaXNzZXMoZG9tLmRvbVRyYWNraW5nLnAxX21pc3NlZClcbiAgICAgICAgICAgICAgICAgICAgcGxheWVyXzFfYm9hcmQucmVuZGVySGl0cyhkb20uZG9tVHJhY2tpbmcucDFfc3VjY2VzcylcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coaW5wdXQpXG4gICAgICAgICAgICAgICAgICAgIHBsYXllcjJfdHVybiA9IGZhbHNlXG4gICAgICAgICAgICAgICAgICAgIHBsYXllcjFfdHVybiA9IHRydWVcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB0aGlzLmVuZEdhbWUocGxheWVyXzFfYm9hcmQsIHBsYXllcl8yX2JvYXJkKVxuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGVuZEdhbWUocGxheWVyMUJvYXJkLCBwbGF5ZXIyQm9hcmQpe1xuICAgICAgICAgICAgaWYgKHBsYXllcjFCb2FyZC5hbGxTaGlwc1N1bmsgPT0gdHJ1ZSB8fCBwbGF5ZXIyQm9hcmQuYWxsU2hpcHNTdW5rID09IHRydWUpe1xuICAgICAgICAgICAgICAgIGdhbWVTdGFydCA9IGZhbHNlXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAocGxheWVyMUJvYXJkLmFsbFNoaXBzU3VuayA9PSB0cnVlKXtcbiAgICAgICAgICAgICAgICBhbGVydCgncGxheWVyIDIgd2lucycpXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAocGxheWVyMkJvYXJkLmFsbFNoaXBzU3VuayA9PSB0cnVlKXtcbiAgICAgICAgICAgICAgICBhbGVydCgncGxheWVyIDEgd2lucycpXG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIC8vIGNvbnNvbGVJbnB1dChxdWVyeSl7XG4gICAgICAgIC8vICAgICBjb25zdCByZWFkbGluZSA9IHJlcXVpcmUoJ3JlYWRsaW5lJylcbiAgICAgICAgLy8gICAgIHZhciBybCA9IHJlYWRsaW5lLmNyZWF0ZUludGVyZmFjZShwcm9jZXNzLnN0ZGluLCBwcm9jZXNzLnN0ZG91dClcbiAgICAgICAgLy8gICAgIHJldHVybiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHtcbiAgICAgICAgLy8gICAgICAgcmwucXVlc3Rpb24ocXVlcnksIChpbnB1dCkgPT4ge1xuICAgICAgICAvLyAgICAgICAgIHJsLmNsb3NlKClcbiAgICAgICAgLy8gICAgICAgICByZXNvbHZlKGlucHV0KVxuICAgICAgICAvLyAgICAgICB9KVxuICAgICAgICAvLyAgICAgfSlcbiAgICAgICAgLy8gICB9LFxuICAgICAgICAvLyBhc3luYyBnZXRDb25zb2xlSW5wdXQocGxheWVyLCBoaXN0b3J5KXtcbiAgICAgICAgLy8gICAgIGxldCB2YWxpZF9hbnMgPSBmYWxzZVxuICAgICAgICAvLyAgICAgd2hpbGUoIXZhbGlkX2Fucyl7XG4gICAgICAgIC8vICAgICAgIGxldCByZXN1bHQgPSBhd2FpdCB0aGlzLmNvbnNvbGVJbnB1dChwbGF5ZXIubmFtZSArICcgRW50ZXIgY29vcmRpbmF0ZXMgdG8gYXR0YWNrICcpXG4gICAgICAgIC8vICAgICAgIGlmKHRoaXMuY2hlY2tIaXN0b3J5KHJlc3VsdCwgaGlzdG9yeSkgPT0gZmFsc2UgJiYgdGhpcy5jaGVja01vdmVzKHJlc3VsdCwgdmFsaWRNb3ZlcykgPT0gdHJ1ZSl7XG4gICAgICAgIC8vICAgICAgICAgY29uc29sZS5sb2coJ3ZhbGlkJylcbiAgICAgICAgLy8gICAgICAgICBoaXN0b3J5LnB1c2gocmVzdWx0KVxuICAgICAgICAvLyAgICAgICAgIHZhbGlkX2FucyA9IHRydWVcbiAgICAgICAgLy8gICAgICAgICByZXR1cm4gcmVzdWx0XG4gICAgICAgIC8vICAgICAgIH1cbiAgICAgICAgLy8gICAgIGVsc2UgaWYgKHRoaXMuY2hlY2tIaXN0b3J5KHJlc3VsdCwgaGlzdG9yeSkgPT0gdHJ1ZSB8fCB0aGlzLmNoZWNrTW92ZXMocmVzdWx0LCB2YWxpZE1vdmVzKSA9PSBmYWxzZSl7XG4gICAgICAgIC8vICAgICAgICAgY29uc29sZS5sb2coJ211c3QgbWFrZSB2YWxpZCBtb3ZlJylcbiAgICAgICAgLy8gICAgICAgICBjb250aW51ZVxuICAgICAgICAvLyAgICAgICB9XG4gICAgICAgIC8vICAgICB9XG4gICAgICAgIC8vICAgICByZXR1cm4gcmVzdWx0XG4gICAgICAgIC8vICAgfSAgIFxuICAgIH1cbn1cbmxldCBtID0gbWFpbkdhbWVGdW5jdGlvbigpXG4vLyBtLm1ha2VNb3ZlcygpXG5cblxuXG5cblxuXG5leHBvcnQge3NoaXBGYWN0b3J5LCBnYW1lQm9hcmRGYWN0b3J5LCBwbGF5ZXJGYWN0b3J5LCBhaUZhY3RvcnksIG1haW5HYW1lRnVuY3Rpb259Il0sIm5hbWVzIjpbIl9fd2VicGFja19yZXF1aXJlX18iLCJleHBvcnRzIiwiZGVmaW5pdGlvbiIsImtleSIsIm8iLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImVudW1lcmFibGUiLCJnZXQiLCJvYmoiLCJwcm9wIiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJjYWxsIiwicGxheWVyMV9jb250YWluZXIiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJwbGF5ZXIyX2NvbnRhaW5lciIsInN0YXJ0R2FtZSIsIm5vdGlmeURvbSIsInN1Ym1pdEJ0biIsImlucHV0QmFyIiwicDFfbWlzc2VkIiwicDFfc3VjY2VzcyIsInAyX21pc3NlZCIsInAyX3N1Y2Nlc3MiLCJwMV9ncmlkIiwicDJfZ3JpZCIsInJlc3RhcnRCdG4iLCJkb21UcmFja2luZyIsImdhbWVTdGFydGVkIiwiaW5wdXRDbGljayIsIlByb21pc2UiLCJyZXNvbHZlIiwib25jbGljayIsImlucHV0IiwidmFsdWUiLCJhZGRFdmVudExpc3RlbmVyIiwiYXN5bmMiLCJtYWluIiwicm93cyIsImNvbHMiLCJjb250YWluZXIiLCJxdWVyeVNlbGVjdG9yQWxsIiwiZm9yRWFjaCIsImluZGV4Iiwic3R5bGUiLCJzZXRQcm9wZXJ0eSIsInNldEF0dHJpYnV0ZSIsImkiLCJjZWxsIiwiY3JlYXRlRWxlbWVudCIsImlubmVyVGV4dCIsImNsYXNzTmFtZSIsImFwcGVuZENoaWxkIiwiZ2FtZWJvYXJkIiwiY2VsbExpc3QiLCJjb29yZHMiLCJib2FyZCIsImFyciIsInB1c2giLCJib3giLCJjZWxsX2xpc3RfYXJyYXkiLCJBcnJheSIsImZyb20iLCJtaWRkbGVJbmRleCIsIk1hdGgiLCJjZWlsIiwibGVuZ3RoIiwiZmlyc3RIYWxmIiwic3BsaWNlIiwic2Vjb25kSGFsZiIsInNwbGl0X2FycmF5IiwiYXJyYXkiLCJpbm5lckhUTUwiLCJjcmVhdGVDb29yZGluYXRlQXJyYXkiLCJjcmVhdGVHcmlkcyIsImdhbWVCb2FyZCIsInBsYXllcl8xX2JvYXJkIiwiZ3JpZEl0ZW1zIiwicGxheWVyXzJfYm9hcmQiLCJhc3NpZ25DZWxsc1RvUGxheWVyQm9hcmRzIiwiY29uc29sZSIsImxvZyIsIm1haW5HYW1lRm4iLCJoaXN0b3J5IiwidmFsaWRfYW5zIiwiZ2V0aW5wdXQiLCJ2YWxpZE1vdmVzIiwic29tZSIsImVsZSIsImluY2x1ZGVzIiwieCIsInBhcnNlSW50IiwieSIsInBsYWNlU2hpcCIsIm1hbmlwdWxhdGVEb20iLCJhbGVydCIsInNldFBsYXllck9uZVNoaXBzIiwidmFsaWRfY29vcmRzIiwicmFuZG9tQ29vcmQiLCJmbG9vciIsInJhbmRvbSIsInNldFBsYXllclR3b1NoaXBzIiwibWFrZU1vdmVzIiwidGV4dENvbnRlbnQiLCJzaGlwRmFjdG9yeSIsInN1bmsiLCJub09mSGl0cyIsImhpdFNoaXAiLCJ0aGlzIiwiaXNTdW5rIiwiZ2FtZUJvYXJkRmFjdG9yeSIsInNpemVPZkJvYXJkIiwibWlzc2VkSGl0cyIsImoiLCJjb29yZCIsIkpTT04iLCJzdHJpbmdpZnkiLCJkYXRhc2V0IiwiYm9hdEltZyIsInNoaXAiLCJjb2xvciIsInNoaXBfcGxhY2VkIiwicm93Iiwibm9PZlNoaXBzIiwiY29sb3JTcXVhcmUiLCJjb29yZGluYXRlcyIsImJhY2tncm91bmRDb2xvciIsInJlY2lldmVBdHRhY2siLCJzdGF0ZSIsImNvb3JkVG9TdHJpbmciLCJub09mU3VjY2VzZnVsSGl0cyIsInN1Y2Nlc3NIaXRzIiwicHVzaEhpdHMiLCJwdXNoTWlzc2VzIiwiY2hlY2tTaGlwU3RhdHVzIiwiYWxsU2hpcHNTdW5rIiwicmVuZGVyTWlzc2VzIiwibWlzc2VkSGl0U2VsZWN0b3IiLCJyZW5kZXJIaXRzIiwic3VjY2Vzc0hpdHNTZWxlY3RvciIsInBsYXllckZhY3RvcnkiLCJuYW1lIiwid2lubmVyIiwibWFpbkdhbWVGdW5jdGlvbiIsImdhbWVTdGFydCIsInBsYXllcjFfdHVybiIsInBsYXllcjJfdHVybiIsInBsYXllcjFfaGlzdG9yeSIsInBsYXllcjJfaGlzdG9yeSIsInBsYXllcjEiLCJwbGF5ZXIyIiwiYWkiLCJ2YWx1ZXMiLCJwMV9zaGlwc1JlYWR5IiwicDJfc2hpcHNSZWFkeSIsImNoZWNrTW92ZXMiLCJhdHRhY2tDb29yZGluYXRlcyIsIm1vdmVzIiwiaXRlbSIsImNoZWNrSGlzdG9yeSIsInBsYXllckhpc3RvcnkiLCJyZXN1bHQiLCJyZWdpc3RlclR1cm4iLCJwbGF5ZXJCb2FyZCIsImF0dGFja0lucHV0IiwicmVjaWV2ZUlucHV0IiwiZW5kR2FtZSIsInBsYXllcjFCb2FyZCIsInBsYXllcjJCb2FyZCJdLCJzb3VyY2VSb290IjoiIn0=